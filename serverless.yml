service: js13kGames-bot

package:
  individually: true
  excludeDevDependencies: false
  exclude:
    - ./**

provider:
  name: aws
  runtime: nodejs12.x
  region: eu-west-1
  stage: stage
  logRetentionInDays: 14
  memorySize: 256
  timeout: 30
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - "s3:PutObject"
        - "s3:PutObjectAcl"
      Resource:
        # - "*"
        - !Join ["/", [!GetAtt deployBucket.Arn, "*"]]

  environment:
    AWS_BUCKET_NAME: !Select [1, !Split [":::", !GetAtt deployBucket.Arn]]
    BROWSERSTACK_KEY: ${env:BROWSERSTACK_KEY}
    BROWSERSTACK_USER: ${env:BROWSERSTACK_USER}

resources:
  Resources:
    deployBucket:
      Type: "AWS::S3::Bucket"
      Properties:
        WebsiteConfiguration:
          IndexDocument: "index.html"

        CorsConfiguration:
          CorsRules:
            - AllowedMethods:
                - "GET"
              AllowedOrigins:
                - "*"

functions:
  bundleAnalyzer:
    package:
      include:
        - build/bundle-analyzer/index.js
    handler: build/bundle-analyzer/index.handle
    events:
      - http: POST analyze-bundle

plugins:
  - serverless-apigw-binary

custom:
  apigwBinary:
    types:
      - "*/*"
      - "multipart/form-data"
      - "image/*"
