var module=noise={};function Grad(a,t,e){this.x=a,this.y=t,this.z=e}Grad.prototype.dot2=function(a,t){return this.x*a+this.y*t},Grad.prototype.dot3=function(a,t,e){return this.x*a+this.y*t+this.z*e};var grad3=[new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)],p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],perm=new Array(512),gradP=new Array(512);function fade(a){return a*a*a*(a*(6*a-15)+10)}function lerp(a,t,e){return(1-e)*a+e*t}function srandom(){var a=1e4*Math.sin(seed++);return a-Math.floor(a)}function orbit(a,t,e,r,n){var o=10*e,i=2*Math.PI*r,d=Math.sqrt(o/r)/i;return{x:Math.cos(n*d)*r+a,y:Math.sin(n*d)*r+t}}function randomColor(a,t){var e,r,n;if(0==a){var o=randomIntRange(128,180);e=o,r=o,n=o}else 1==a?randomIntRange(0,100)>=50?(e=randomIntRange(50,170)*t,r=randomIntRange(90,200)*t,n=randomIntRange(80,170)*t):(e=randomIntRange(100,200),r=randomIntRange(80,170),n=randomIntRange(50,100)):2==a?(e=randomIntRange(100,250),r=randomIntRange(40,100),n=randomIntRange(50,100)):3==a?(e=randomIntRange(50,200),r=randomIntRange(50,200),n=randomIntRange(50,200)):(e=255,r=0,n=255);return"rgb("+e*t+","+r*t+","+n*t+")"}function makeColorAlpha(a){var t=a;return t=(t=t.splice(0,4,"")).splice(a.length-5,2,"")}function randomIntRange(a,t){return Math.floor(a+srandom()*(t+1-a))}function imageDataToImage(a){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=a.width,t.height=a.height,e.putImageData(a,0,0);var r=new Image;return r.src=t.toDataURL(),t.outerHTML="",r}function drawBright(a,t,e,r){var n=ctx.globalCompositeOperation;ctx.globalCompositeOperation="lighter",ctx.translate(a,t),ctx.scale(e,e),ctx.drawImage(brightImage,-brightData.width/2,-brightData.height/2),ctx.scale(1/e,1/e),ctx.translate(-a,-t),ctx.globalCompositeOperation=n}module.seed=function(a){a>0&&a<1&&(a*=65536),(a=Math.floor(a))<256&&(a|=a<<8);for(var t=0;t<256;t++){var e;e=1&t?p[t]^255&a:p[t]^a>>8&255,perm[t]=perm[t+256]=e,gradP[t]=gradP[t+256]=grad3[e%12]}},module.seed(0),module.perlin2=function(a,t){var e=Math.floor(a),r=Math.floor(t);a-=e,t-=r;var n=gradP[(e&=255)+perm[r&=255]].dot2(a,t),o=gradP[e+perm[r+1]].dot2(a,t-1),i=gradP[e+1+perm[r]].dot2(a-1,t),d=gradP[e+1+perm[r+1]].dot2(a-1,t-1),s=fade(a);return lerp(lerp(n,i,s),lerp(o,d,s),fade(t))},String.prototype.splice||(String.prototype.splice=function(a,t,e){return this.slice(0,a)+e+this.slice(a+Math.abs(t))}),seed=100,noise.seed(seed);let previousTime=0;var time=0,canvas=document.getElementById("canvas");canvas.width=.8*window.innerWidth,canvas.height=.8*window.innerHeight;var starFieldImage,brightImage,ctx=canvas.getContext("2d"),backdropScale=1,starFieldData=ctx.createImageData(canvas.width*backdropScale,canvas.height*backdropScale),brightSize=768,brightData=ctx.createImageData(brightSize,brightSize),sun=createStar(0,0,5e3,"rgb(255, 240, 200)","White");sun.mass=5*Math.PI*sun.radius*sun.radius;var planets=Array(),planetCount=randomIntRange(5,11),rings=Array(),camera={x:0,y:0,zoom:.5};function update(a){for(var t=0;t<planets.length;t++){var e,r,n,o=planets[t];-1==o.center?(e=0,r=0,n=sun.mass):(e=planets[o.center].x,r=planets[o.center].y,n=planets[o.center].mass);var i=orbit(e,r,n,o.orbitRadius,time+o.orbitOffset);o.x=i.x,o.y=i.y}camera.x=planets[2].x,camera.y=planets[2].y,camera.zoom=.05,time+=10*a}function render(){ctx.setTransform(1,0,0,1,0,0),ctx.putImageData(starFieldData,0,0),ctx.translate(canvas.width/2,canvas.height/2),ctx.scale(camera.zoom,camera.zoom),ctx.translate(-camera.x,-camera.y);for(var a=0;a<rings.length;a++)drawRing(rings[a],time);drawBright(0,0,125);for(a=0;a<planets.length;a++)drawPlanet(planets[a]);for(a=0;a<planets.length;a++)drawPlanetShadow(planets[a]);drawStar(sun)}generateStarfield(),generateBright(),generate();const loop=a=>{const t=a-previousTime;previousTime=a,update(t/1e3),render(),window.requestAnimationFrame(loop)};function generateBright(){for(var a=0;a<brightSize;a++)for(var t=0;t<brightSize;t++){var e=0,r=a*brightSize+t,n=t-brightSize/2,o=a-brightSize/2,i=brightSize/((n*n+o*o)/6);e=i;var d=Math.atan2(o,n);e+=.6*noise.perlin2(15*d,0),e-=1-Math.pow(i,.03);var s=Math.max(1-(i-1)*(i-1),0),l=Math.max(1-(i-1.2)*(i-1.2),0),c=Math.max(1-(i-1.4)*(i-1.4),0),m=noise.perlin2(8*d,1)*s+s,g=noise.perlin2(16*d,7)*l+l,h=noise.perlin2(32*d,15)*c+c;brightData.data[4*r+0]=200*e+128*m,brightData.data[4*r+1]=160*e+118*g,brightData.data[4*r+2]=128*e+98*h,brightData.data[4*r+3]=255*e}brightImage=imageDataToImage(brightData)}function generateStarfield(){for(var a=0;a<canvas.height*backdropScale;a++)for(var t=0;t<canvas.width*backdropScale;t++){var e=a*canvas.width*backdropScale+t,r=0,n=0,o=0,i=noise.perlin2(.001*t,.001*a),d=noise.perlin2(.01*t+i,.01*a+i),s=noise.perlin2(.05*t,.05*a),l=noise.perlin2(.01*t+5,.01*a+5);if(n=.7*(r=255*(d+s+i))+60*l,o=.5*r+128*l,randomIntRange(0,1e4)>=9995)r=255,n=255,o=255;else{r*=.25,n*=.25,o*=.25}starFieldData.data[4*e+0]=r,starFieldData.data[4*e+1]=n,starFieldData.data[4*e+2]=o,starFieldData.data[4*e+3]=255}starFieldImage=imageDataToImage(starFieldData)}function generatePlanet(a,t){var e;if(0==a){var r=randomIntRange(250,850)*t;e=createPlanet(randomIntRange(25,60),randomIntRange(140,150),r,0,randomColor(0,1),randomColor(0,.5),randomColor(0,1),"0, 0, 0",randomIntRange(0,1e4),64)}else if(1==a){r=randomIntRange(300,600)*t;e=createPlanet(randomIntRange(25,30),randomIntRange(90,160),r,r+randomIntRange(120,170),randomColor(1,1),randomColor(1,.5),randomColor(1,1),"120, 120, 255",randomIntRange(0,1e4),64)}else if(2==a){r=randomIntRange(350,900)*t;e=createPlanet(randomIntRange(15,25),randomIntRange(80,120),r,r+randomIntRange(120,170),randomColor(2,1),randomColor(2,.5),randomColor(2,1),"255, 120, 120",randomIntRange(0,1e4),64)}else if(3==a){r=randomIntRange(700,1800)*t;var n=randomColor(3,1);e=createGasPlanet(r,r+randomIntRange(50,300),makeColorAlpha(n),n,randomColor(3,1))}else if(4==a){r=randomIntRange(40,120)*t;e=createPlanet(randomIntRange(25,60),randomIntRange(140,150),r,0,randomColor(2,1),randomColor(2,.5),randomColor(2,1),"0, 0, 0",randomIntRange(0,1e4),32)}return e.mass=4*Math.PI*e.radius*e.radius,e}function generate(){for(var a=0;a<planetCount;a++){var t=randomIntRange(0,4),e=randomIntRange(9e3,12e4);1==t&&(e<=4e4||e>=8e4)&&(t=2),(o=generatePlanet(t,1)).orbitRadius=e,o.orbitOffset=randomIntRange(-5e4,5e4),o.center=-1,o.type=t,planets.push(o)}for(a=0;a<planetCount;a++){for(var r=randomIntRange(0,planets[a].radius/350),n=0;n<r;n++){var o;3==(t=randomIntRange(0,4))&&(t=0),(o=generatePlanet(t,.01*randomIntRange(25,60))).radius>=.6*planets[a].radius&&(o.radius*=.5);var i=planets[a].radius+5*o.radius,d=planets[a].orbitRadius/4e3;o.orbitRadius=randomIntRange(i,i+planets[a].radius*d),o.orbitOffset=randomIntRange(0,5e5),o.center=a,o.type=t,planets.push(o)}if(randomIntRange(0,1e3)>=900&&planets[a].radius>=600){var s=randomIntRange(1.5*planets[a].radius,6*planets[a].radius),l=createRing(a,s,s+.01*randomIntRange(0,400)*planets[a].radius,3e-8*randomIntRange(80,400));rings.push(l)}}var c=!1,m=!1,g=!1,h=!1;for(a=0;a<planets.length;a++)1==planets[a].type&&(c=!0),2==planets[a].type&&(g=!0),3==planets[a].type&&(m=!0),4==planets[a].type&&(h=!0);(0==c||0==m||0==g||0==h||rings.length<=1)&&(planets=[],seed+=randomIntRange(1,5e3),generate())}function createPlanet(a,t,e,r,n,o,i,d,s,l){var c=Array(l),m=Array(l);noise.seed(s);for(var g=0;g<l;g++){var h=noise.perlin2(g/l*a*1,0)*t,u=noise.perlin2(g/l*a*2,5)*t*.5,p=noise.perlin2(g/l*a*4,8)*t*.25;c[g]=Math.max(h+u,0),m[g]=noise.perlin2(g/l*a,40)*t+p}return{x:0,y:0,radius:e,atmoRadius:r,colorInner:n,colorOuter:o,colorDetail:i,colorAtmo:d,heights:c,bheights:m,isGasPlanet:!1}}function createGasPlanet(a,t,e,r,n){return{x:0,y:0,radius:a,atmoRadius:t,colorAtmo:e,color0:r,color1:n,isGasPlanet:!0}}function drawAtmosphere(a,t,e,r,n){var o=ctx.createRadialGradient(a,t,e,a,t,r);o.addColorStop(0,"rgba("+n+",0.5)"),o.addColorStop(1,"rgb("+n+", 0)"),ctx.fillStyle=o,ctx.beginPath(),ctx.arc(a,t,r,0,2*Math.PI),ctx.fill()}function drawPlanetShadow(a){var t=a.x*a.x+a.y*a.y,e=Math.sqrt(t+a.radius*a.radius),r=Math.PI/2-Math.atan2(-a.y,-a.x),n=Math.acos(a.radius/e),o=r-n,i=r+n,d=1*a.radius;0!=a.atmoRadius&&(d=a.atmoRadius);var s=a.x+Math.sin(o)*d,l=a.y+Math.cos(o)*d,c=a.x+Math.sin(i)*d,m=a.y+Math.cos(i)*d,g=32*a.radius,h=Math.sqrt(s*s+l*l),u=Math.sqrt(c*c+m*m),p=Math.sqrt(t),x=s/h,f=l/h,I=c/u,R=m/u,v=ctx.createLinearGradient(a.x,a.y,a.x+a.x/p*g,a.y+a.y/p*g),y=.005+Math.max((a.atmoRadius-a.radius)/32e3,0);v.addColorStop(0,"rgba(0, 0, 0, 0)"),v.addColorStop(y,"rgba(0, 0, 0, 255)"),v.addColorStop(1,"rgba(0, 0, 0, 0)"),ctx.fillStyle=v,ctx.beginPath(),ctx.moveTo(s,l),ctx.lineTo(s+x*g,l+f*g),ctx.lineTo(c+I*g,m+R*g),ctx.lineTo(c,m),ctx.closePath(),ctx.fill()}function drawPlanet(a){if(1==a.isGasPlanet)ctx.fillStyle=a.color0,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI),ctx.fill(),drawAtmosphere(a.x,a.y,a.radius,a.atmoRadius,a.colorAtmo);else{ctx.fillStyle=a.colorOuter,ctx.beginPath();for(var t=a.heights.length,e=0;e<t;e++){var r=e/t*2*Math.PI,n=Math.cos(r),o=Math.sin(r),i=a.bheights[e]+15;n=n*a.radius+n*i+a.x,o=o*a.radius+o*i+a.y,0==e?ctx.moveTo(n,o):ctx.lineTo(n,o)}ctx.closePath(),ctx.fill(),a.atmoRadius>=0&&drawAtmosphere(a.x,a.y,a.radius,a.atmoRadius,a.colorAtmo),ctx.fillStyle=a.colorInner,ctx.beginPath();for(t=a.heights.length,e=0;e<t;e++){r=e/t*2*Math.PI,n=Math.cos(r),o=Math.sin(r),i=a.heights[e]+5;n=n*a.radius+n*i+a.x,o=o*a.radius+o*i+a.y,0==e?ctx.moveTo(n,o):ctx.lineTo(n,o)}ctx.closePath(),ctx.fill(),ctx.fillStyle=a.colorDetail,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI),ctx.fill()}}function createRing(a,t,e,r){var n=(Math.PI*e*e-Math.PI*t*t)*r,o=Array();n>=64&&(n=64);for(var i=0;i<n;i++){var d=randomIntRange(t,e),s=randomIntRange(-1e4,1e4),l=randomIntRange(5,50),c=randomColor(2,.6);o.push({orbitRadius:d,offset:s,size:l,color:c})}return{center:a,minRadius:t,maxRadius:e,rocks:o}}function distance(a,t,e,r){var n=e-a,o=r-t;return Math.sqrt(n*n+o*o)}function maxCameraReach(){return Math.max(canvas.width,canvas.height)/camera.zoom}function drawRing(a,t){var e=planets[a.center].x,r=planets[a.center].y;if(camera.zoom>=.01&&distance(camera.x,camera.y,e,r)<=maxCameraReach()+a.maxRadius)for(var n=0;n<a.rocks.length;n++){var o=a.rocks[n],i=orbit(e,r,planets[a.center].mass,o.orbitRadius,t+o.offset);ctx.fillStyle=o.color,ctx.beginPath(),ctx.arc(i.x,i.y,o.size,0,2*Math.PI),ctx.fill()}}function createStar(a,t,e,r,n){return{x:a,y:t,radius:e,color:r,outColor:n}}function drawStar(a){var t=ctx.createRadialGradient(a.x,a.y,a.radius/1.5,a.x,a.y,a.radius);t.addColorStop(0,a.color),t.addColorStop(1,a.outColor),ctx.fillStyle=t,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI),ctx.fill()}window.requestAnimationFrame(a=>{previousTime=a,loop(a)}),document.onkeydown=function(a){};