var module=noise={};function Grad(r,t,a){this.x=r,this.y=t,this.z=a}Grad.prototype.dot2=function(r,t){return this.x*r+this.y*t},Grad.prototype.dot3=function(r,t,a){return this.x*r+this.y*t+this.z*a};var grad3=[new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)],p=new Array;for(i of atob`l6CJW1oPgw3JX2A1wukH4YwkZx5FjghjJfAVChe+BpT3eOpLABrFPl7828t1IwsgObEhWO2VOFeuFH2Iq6hEr0qlR4aLMBumTZKe51Nv5Xo804Xm3GlcKTcu9Sj0Zo82QRk/oQHYUEnRTIS70FkSqcjEh4J0vJ9WpGRtxq26A0A02eL6fHsFyiaTdn7/UlXUz8474y8QOhG2vRwq37eq1Xf4mAIsmqNG3Zllm6crrAmBFif9E2Jsbk9x4OiyuXBo2vZh5Psi8sHu0pAMv7Oi8VEzkev5Du9rMcDWH7XHap24VMywc3kyLX8Elv6K7M1d3nJDHRhI842Aw05C1z2ctA`)p.push(i.charCodeAt());var perm=new Array(512),gradP=new Array(512);function fade(r){return r*r*r*(r*(6*r-15)+10)}function lerp(r,t,a){return(1-a)*r+a*t}function srandom(){var r=1e4*Math.sin(seed++);return r-Math.floor(r)}function orbit(r,t,a,e,i){var n=.5*a,s=2*Math.PI*e,o=Math.sqrt(n/e)/s;return{x:Math.cos(i*o)*e+r,y:Math.sin(i*o)*e+t}}function randomColor(r,t){var a,e,i;if(0==r){var n=rrg(128,180);a=n,e=n,i=n}else 1==r?rrg(0,100)>=50?(a=rrg(50,170),e=rrg(90,200),i=rrg(80,170)):(a=rrg(100,200),e=rrg(80,170),i=rrg(50,100)):2==r?(a=rrg(100,250),e=rrg(40,100),i=rrg(50,100)):3==r?(a=rrg(50,200),e=rrg(50,200),i=rrg(50,200)):(a=255,e=0,i=255);return"rgb("+a*t+","+e*t+","+i*t+")"}function makeColorAlpha(r){var t=r;return t=(t=t.splice(0,4,"")).splice(r.length-5,2,"")}function rrg(r,t){return Math.floor(r+srandom()*(t+1-r))}function imageDataToImage(r){var t=document.createElement("canvas"),a=t.getContext("2d");t.width=r.width,t.height=r.height,a.putImageData(r,0,0);var e=new Image;return e.src=t.toDataURL(),t.outerHTML="",e}function drawBright(r,t,a,e){var i=ctx.globalCompositeOperation;ctx.globalCompositeOperation="lighter",ctx.translate(r,t),ctx.scale(a,a),ctx.drawImage(brightImage,-brightData.width/2,-brightData.height/2),ctx.scale(1/a,1/a),ctx.translate(-r,-t),ctx.globalCompositeOperation=i}function doCameraTransform(){ctx.translate(canvas.width/2,canvas.height/2),ctx.scale(camera.zoom,camera.zoom),ctx.translate(-camera.x,-camera.y)}function sanitizeAngle(r){var t=r;return Math.abs(t)>=2*Math.PI&&(t%=2*Math.PI),t<=0&&(t=2*Math.PI+t),t}module.seed=function(r){r>0&&r<1&&(r*=65536),(r=Math.floor(r))<256&&(r|=r<<8);for(var t=0;t<256;t++){var a;a=1&t?p[t]^255&r:p[t]^r>>8&255,perm[t]=perm[t+256]=a,gradP[t]=gradP[t+256]=grad3[a%12]}},module.seed(0),module.perlin2=function(r,t){var a=Math.floor(r),e=Math.floor(t);r-=a,t-=e;var i=gradP[(a&=255)+perm[e&=255]].dot2(r,t),n=gradP[a+perm[e+1]].dot2(r,t-1),s=gradP[a+1+perm[e]].dot2(r-1,t),o=gradP[a+1+perm[e+1]].dot2(r-1,t-1),l=fade(r);return lerp(lerp(i,s,l),lerp(n,o,l),fade(t))},String.prototype.splice||(String.prototype.splice=function(r,t,a){return this.slice(0,r)+a+this.slice(r+Math.abs(t))}),seed=100,noise.seed(seed);let previousTime=0;var time=0,canvas=document.getElementById("canvas");canvas.width=.8*window.innerWidth,canvas.height=.8*window.innerHeight;var starFieldImage,brightImage,ctx=canvas.getContext("2d"),backdropScale=1,starFieldData=ctx.createImageData(canvas.width*backdropScale,canvas.height*backdropScale),brightSize=768,brightData=ctx.createImageData(brightSize,brightSize),sun=createStar(0,0,5e3,"rgb(255, 240, 200)","White");sun.mass=5*Math.PI*sun.radius*sun.radius;var planets=Array(),planetCount=rrg(5,11),ships=Array(),rings=Array(),camera={x:0,y:0,zoom:.5},aimPoint={x:0,y:0};function update(r){for(var t=0;t<planets.length;t++){var a,e,i,n=planets[t];-1==n.center?(a=0,e=0,i=sun.mass):(a=planets[n.center].x,e=planets[n.center].y,i=planets[n.center].mass);var s=orbit(a,e,i,n.orbitRadius,time+n.orbitOffset);n.x=s.x,n.y=s.y}ships[0].rot+=.4*r;var o=orbit(planets[1].x,planets[1].y,planets[0].mass,1200,time+1e3);ships[0].x=o.x,ships[0].y=o.y,aimPoint.x=ships[0].x+150*Math.sin(.1*time),aimPoint.y=ships[0].y+150*Math.cos(.1*time),aimShipGuns(ships[0],aimPoint,r),camera.x=ships[0].x,camera.y=ships[0].y,time+=10*r}function render(){ctx.setTransform(1,0,0,1,0,0),ctx.putImageData(starFieldData,0,0),doCameraTransform();for(var r=0;r<rings.length;r++)drawRing(rings[r],time);drawBright(0,0,125);for(r=0;r<planets.length;r++)drawPlanet(planets[r]);for(r=0;r<ships.length;r++)drawShip(ships[r]);for(r=0;r<planets.length;r++)drawPlanetShadow(planets[r]);drawBright(aimPoint.x,aimPoint.y,.1),drawStar(sun)}generateStarfield(),generateBright(),generate(),ships.push(createShip(2,32400)),ships[0].x=1e5,ships[0].y=1e5;const loop=r=>{const t=r-previousTime;previousTime=r,update(t/1e3),render(),window.requestAnimationFrame(loop)};function onwheel(r){camera.zoom-=.02*camera.zoom*r.deltaY,camera.zoom}function generateBright(){for(var r=0;r<brightSize;r++)for(var t=0;t<brightSize;t++){var a=r*brightSize+t,e=t-brightSize/2,i=r-brightSize/2,n=brightSize/((e*e+i*i)/6),s=n,o=Math.atan2(i,e);s+=.6*noise.perlin2(15*o,0),s-=1-Math.pow(n,.03);var l=Math.max(1-(n-1)*(n-1),0),h=Math.max(1-(n-1.2)*(n-1.2),0),c=Math.max(1-(n-1.4)*(n-1.4),0),d=noise.perlin2(8*o,1)*l+l,g=noise.perlin2(16*o,7)*h+h,x=noise.perlin2(32*o,15)*c+c;brightData.data[4*a+0]=200*s+128*d,brightData.data[4*a+1]=160*s+118*g,brightData.data[4*a+2]=128*s+98*x,brightData.data[4*a+3]=255*s}brightImage=imageDataToImage(brightData)}function generateStarfield(){for(var r=0;r<canvas.height*backdropScale;r++)for(var t=0;t<canvas.width*backdropScale;t++){var a=r*canvas.width*backdropScale+t,e=0,i=0,n=0,s=noise.perlin2(.001*t,.001*r),o=noise.perlin2(.01*t+s,.01*r+s),l=noise.perlin2(.05*t,.05*r),h=noise.perlin2(.01*t+5,.01*r+5);if(i=.7*(e=255*(o+l+s))+60*h,n=.5*e+128*h,rrg(0,1e4)>=9995)e=255,i=255,n=255;else{e*=.25,i*=.25,n*=.25}starFieldData.data[4*a+0]=e,starFieldData.data[4*a+1]=i,starFieldData.data[4*a+2]=n,starFieldData.data[4*a+3]=255}starFieldImage=imageDataToImage(starFieldData)}function generatePlanet(r,t){var a;if(0==r){var e=rrg(250,850)*t;a=createPlanet(rrg(25,60),rrg(140,150),e,0,randomColor(0,1),randomColor(0,.5),randomColor(0,1),"0, 0, 0",rrg(0,1e4),64)}else if(1==r){e=rrg(300,600)*t;a=createPlanet(rrg(25,30),rrg(90,160),e,e+rrg(120,170),randomColor(1,1),randomColor(1,.5),randomColor(1,1),"120, 120, 255",rrg(0,1e4),64)}else if(2==r){e=rrg(350,900)*t;a=createPlanet(rrg(15,25),rrg(80,120),e,e+rrg(120,170),randomColor(2,1),randomColor(2,.5),randomColor(2,1),"255, 120, 120",rrg(0,1e4),64)}else if(3==r){e=rrg(700,1800)*t;var i=randomColor(3,1);a=createGasPlanet(e,e+rrg(50,300),makeColorAlpha(i),i,randomColor(3,1))}else if(4==r){e=rrg(40,120)*t;a=createPlanet(rrg(25,60),rrg(140,150),e,0,randomColor(2,1),randomColor(2,.5),randomColor(2,1),"0, 0, 0",rrg(0,1e4),32)}return a.mass=4*Math.PI*a.radius*a.radius,a}function generate(){for(var r=0;r<planetCount;r++){var t=rrg(0,4),a=rrg(9e3,12e4);1==t&&(a<=4e4||a>=8e4)&&(t=2),(n=generatePlanet(t,1)).orbitRadius=a,n.orbitOffset=rrg(-5e4,5e4),n.center=-1,n.type=t,planets.push(n)}for(r=0;r<planetCount;r++){for(var e=rrg(0,planets[r].radius/350),i=0;i<e;i++){var n;3==(t=rrg(0,4))&&(t=0),(n=generatePlanet(t,.01*rrg(25,60))).radius>=.6*planets[r].radius&&(n.radius*=.5);var s=planets[r].radius+5*n.radius,o=planets[r].orbitRadius/4e3;n.orbitRadius=rrg(s,s+planets[r].radius*o),n.orbitOffset=rrg(0,5e5),n.center=r,n.type=t,planets.push(n)}if(rrg(0,1e3)>=900&&planets[r].radius>=600){var l=rrg(1.5*planets[r].radius,6*planets[r].radius),h=createRing(r,l,l+.01*rrg(0,400)*planets[r].radius,3e-8*rrg(80,400));rings.push(h)}}var c=!1,d=!1,g=!1,x=!1;for(r=0;r<planets.length;r++)1==planets[r].type&&(c=!0),2==planets[r].type&&(g=!0),3==planets[r].type&&(d=!0),4==planets[r].type&&(x=!0);(0==c||0==d||0==g||0==x||rings.length<=1)&&(planets=[],seed+=rrg(1,5e3),generate())}function createPlanet(r,t,a,e,i,n,s,o,l,h){var c=Array(h),d=Array(h);noise.seed(l);for(var g=0;g<h;g++){var x=noise.perlin2(g/h*r*1,0)*t,u=noise.perlin2(g/h*r*2,5)*t*.5,p=noise.perlin2(g/h*r*4,8)*t*.25;c[g]=Math.max(x+u,0),d[g]=noise.perlin2(g/h*r,40)*t+p}return{x:0,y:0,radius:a,atmoRadius:e,colorInner:i,colorOuter:n,colorDetail:s,colorAtmo:o,heights:c,bheights:d,isGasPlanet:!1}}function createGasPlanet(r,t,a,e,i){return{x:0,y:0,radius:r,atmoRadius:t,colorAtmo:a,color0:e,color1:i,isGasPlanet:!0}}function drawAtmosphere(r,t,a,e,i){var n=ctx.createRadialGradient(r,t,a,r,t,e);n.addColorStop(0,"rgba("+i+",0.5)"),n.addColorStop(1,"rgb("+i+", 0)"),ctx.fillStyle=n,ctx.beginPath(),ctx.arc(r,t,e,0,2*Math.PI),ctx.fill()}function drawPlanetShadow(r){var t=r.x*r.x+r.y*r.y,a=Math.sqrt(t+r.radius*r.radius),e=Math.PI/2-Math.atan2(-r.y,-r.x),i=Math.acos(r.radius/a),n=e-i,s=e+i,o=1*r.radius;0!=r.atmoRadius&&(o=r.atmoRadius);var l=r.x+Math.sin(n)*o,h=r.y+Math.cos(n)*o,c=r.x+Math.sin(s)*o,d=r.y+Math.cos(s)*o,g=32*r.radius,x=Math.sqrt(l*l+h*h),u=Math.sqrt(c*c+d*d),p=Math.sqrt(t),m=l/x,y=h/x,f=c/u,v=d/u,M=ctx.createLinearGradient(r.x,r.y,r.x+r.x/p*g,r.y+r.y/p*g),P=.005+Math.max((r.atmoRadius-r.radius)/32e3,0);M.addColorStop(0,"rgba(0, 0, 0, 0)"),M.addColorStop(P,"rgba(0, 0, 0, 0.8)"),M.addColorStop(1,"rgba(0, 0, 0, 0)"),ctx.fillStyle=M,ctx.beginPath(),ctx.moveTo(l,h),ctx.lineTo(l+m*g,h+y*g),ctx.lineTo(c+f*g,d+v*g),ctx.lineTo(c,d),ctx.closePath(),ctx.fill()}function drawPlanet(r){if(1==r.isGasPlanet)ctx.fillStyle=r.color0,ctx.beginPath(),ctx.arc(r.x,r.y,r.radius,0,2*Math.PI),ctx.fill(),drawAtmosphere(r.x,r.y,r.radius,r.atmoRadius,r.colorAtmo);else{ctx.fillStyle=r.colorOuter,ctx.beginPath();for(var t=r.heights.length,a=0;a<t;a++){var e=a/t*2*Math.PI,i=Math.cos(e),n=Math.sin(e),s=r.bheights[a]+15;i=i*r.radius+i*s+r.x,n=n*r.radius+n*s+r.y,0==a?ctx.moveTo(i,n):ctx.lineTo(i,n)}ctx.closePath(),ctx.fill(),r.atmoRadius>=0&&drawAtmosphere(r.x,r.y,r.radius,r.atmoRadius,r.colorAtmo),ctx.fillStyle=r.colorInner,ctx.beginPath();for(t=r.heights.length,a=0;a<t;a++){e=a/t*2*Math.PI,i=Math.cos(e),n=Math.sin(e),s=r.heights[a]+5;i=i*r.radius+i*s+r.x,n=n*r.radius+n*s+r.y,0==a?ctx.moveTo(i,n):ctx.lineTo(i,n)}ctx.closePath(),ctx.fill(),ctx.fillStyle=r.colorDetail,ctx.beginPath(),ctx.arc(r.x,r.y,r.radius,0,2*Math.PI),ctx.fill()}}function createRing(r,t,a,e){var i=(Math.PI*a*a-Math.PI*t*t)*e,n=Array();i>=64&&(i=64);for(var s=0;s<i;s++){var o=rrg(t,a),l=rrg(-1e4,1e4),h=rrg(5,50),c=randomColor(2,.6);n.push({orbitRadius:o,offset:l,size:h,color:c})}return{center:r,minRadius:t,maxRadius:a,rocks:n}}function distance(r,t,a,e){var i=a-r,n=e-t;return Math.sqrt(i*i+n*n)}function maxCameraReach(){return Math.max(canvas.width,canvas.height)/camera.zoom}function drawRing(r,t){var a=planets[r.center].x,e=planets[r.center].y;if(camera.zoom>=.01&&distance(camera.x,camera.y,a,e)<=maxCameraReach()+r.maxRadius)for(var i=0;i<r.rocks.length;i++){var n=r.rocks[i],s=orbit(a,e,planets[r.center].mass,n.orbitRadius,t+n.offset);ctx.fillStyle=n.color,ctx.beginPath(),ctx.arc(s.x,s.y,n.size,0,2*Math.PI),ctx.fill()}}function createShip(r,t){let a=[1,10,50,100,50,.5,6,100,200,150,.2,2,400,250,80];seed=t;var e,i={},n=Array(),s=Array(),o=Array();if(0==r){var l=(e=(g=.5*rrg(50,100))*rrg(100,140)*.01)/(2*g);n.push({x:-g/2,y:0}),n.push({x:g/2,y:0}),n.push({x:0,y:e});var h=g*rrg(30,70)*.005;o.push({x:-h,y:0,size:6,t:0}),o.push({x:h,y:0,size:6,t:0});var c=(d=rrg(60,90)*e*.01)*l*.5;s.push({x:c,y:d,dir:0,size:12,angle:Math.PI/2.5,speed:8}),s.push({x:-c,y:d,dir:0,size:12,angle:Math.PI/2.5,speed:8})}else if(1==r){e=(g=.5*rrg(100,160))*rrg(140,180)*.01,n.push({x:-g/2,y:0}),n.push({x:g/2,y:0}),n.push({x:g/2,y:e}),n.push({x:-g/2,y:e});h=g*rrg(30,70)*.05,h=g*rrg(30,70)*.005;o.push({x:-h,y:0,size:12,t:0}),o.push({x:h,y:0,size:12,t:0});var d=rrg(70,100)*e*.01;c=rrg(50,80)*g*.005;s.push({x:c,y:d,dir:0,size:16,angle:Math.PI/2,speed:4}),s.push({x:-c,y:d,dir:0,size:16,angle:Math.PI/2,speed:4});d=rrg(30,60)*e*.01,c=rrg(50,80)*g*.005;s.push({x:c,y:d,dir:-Math.PI/2,size:24,angle:Math.PI/2,speed:2}),s.push({x:-c,y:d,dir:Math.PI/2,size:24,angle:Math.PI/2,speed:2})}else if(2==r){var g;e=(g=.5*rrg(180,260))*rrg(200,320)*.01;var x=g*rrg(40,70)*.01,u=rrg(30,60)*e*.01;n.push({x:g/2,y:0}),n.push({x:x/2,y:u}),n.push({x:g/2,y:e}),n.push({x:0,y:1.1*e}),n.push({x:-g/2,y:e}),n.push({x:-x/2,y:u}),n.push({x:-g/2,y:0}),o.push({x:0,y:0,size:20,t:0}),o.push({x:g/2.2,y:0,size:14,t:0}),o.push({x:-g/2.2,y:0,size:14,t:0}),s.push({x:0,y:u,dir:0,size:32,angle:Math.PI/2,speed:2}),s.push({x:x/2.2,y:1.8*u,dir:-Math.PI/2,size:20,angle:Math.PI/2,speed:2}),s.push({x:-x/2.2,y:1.8*u,dir:Math.PI/2,size:20,angle:Math.PI/2,speed:2}),s.push({x:x/1.8,y:.95*e,dir:0,size:20,angle:Math.PI/2.5,speed:4}),s.push({x:-x/1.8,y:.95*e,dir:0,size:20,angle:Math.PI/2.5,speed:4})}return i.maneouver=a[5*r+0],i.speed=a[5*r+1],i.armor=a[5*r+2],i.fuel=a[5*r+3],i.cargo=a[5*r+4],{type:r,stats:i,hull:n,weapons:s,thrusters:o,length:e,x:0,y:0,rot:0}}function drawShip(r){ctx.translate(r.x,r.y),ctx.scale(.25,.25),ctx.rotate(r.rot),ctx.translate(0,-r.length/2),ctx.fillStyle="rgb(100, 100, 100)",ctx.strokeStyle="rgb(255, 255, 255)",ctx.lineWidth=2,ctx.beginPath();for(var t=0;t<r.hull.length;t++)0==t?ctx.moveTo(r.hull[t].x,r.hull[t].y):ctx.lineTo(r.hull[t].x,r.hull[t].y),t==r.hull.length-1&&ctx.lineTo(r.hull[0].x,r.hull[0].y);ctx.fill(),ctx.stroke();for(t=0;t<r.thrusters.length;t++){ctx.fillStyle="rgb(60, 60, 60)",ctx.strokeStyle="rgb(255, 255, 255)",ctx.lineWidth=2;var a=r.thrusters[t],e=a.size;ctx.beginPath(),ctx.moveTo(a.x,a.y),ctx.lineTo(a.x-.7*e,a.y-2*e),ctx.lineTo(a.x+.7*e,a.y-2*e),ctx.lineTo(a.x,a.y),ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.arc(a.x,a.y,e,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.fillStyle="rgb(255, 255, 255)",ctx.strokeStyle="rgb(180, 180, 255)",ctx.lineWidth=4;var i=8*(a.t+.05);ctx.beginPath(),ctx.moveTo(a.x+.7*e,a.y-2*e),ctx.lineTo(a.x,a.y-e*(i+2)),ctx.lineTo(a.x-.7*e,a.y-2*e),ctx.fill(),ctx.stroke()}for(t=0;t<r.weapons.length;t++){ctx.fillStyle="rgb(170, 90, 90)",ctx.strokeStyle="rgb(255, 255, 255)",ctx.lineWidth=2;var n=r.weapons[t],s=n.size;ctx.beginPath(),ctx.rect(n.x-s/2,n.y-s/2,s,s),ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.lineWidth=4,ctx.moveTo(n.x,n.y);var o=1.5*s;ctx.lineTo(n.x+o*Math.cos(n.rdir+Math.PI/2-r.rot),n.y+o*Math.sin(n.rdir+Math.PI/2-r.rot)),ctx.stroke()}ctx.setTransform(1,0,0,1,0,0),doCameraTransform()}function setShipThrust(r,t,a){if(r.thrusters.length>2){var e=1-Math.abs(t-a);r.thrusters[0].t=e,r.thrusters[1].t=a,r.thrusters[2].t=t}else r.thrusters[0].t=a,r.thrusters[1].t=t}function aimShipGuns(r,t,a){r.rot=sanitizeAngle(r.rot);for(var e=t.x-r.x,i=t.y-r.y,n=0;n<r.weapons.length;n++){var s=r.weapons[n];s.dir=sanitizeAngle(s.dir);var o=Math.cos(r.rot+s.dir+Math.PI/2),l=Math.sin(r.rot+s.dir+Math.PI/2),h=s.dir+r.rot,c=Math.atan2(i-l,e-o),d=Math.atan2(i,e)-Math.atan2(l,o);d>Math.PI?d-=2*Math.PI:d<=-Math.PI&&(d+=2*Math.PI),Math.abs(d)<=s.angle?(s.wdir=c-.5*Math.PI,s.aim=!0):(s.wdir=h,s.aim=!1),null==s.rdir&&(s.rdir=h);var g=s.rdir-s.wdir;Math.abs(g)>=.5?s.rdir-=Math.sign(g)*a*s.speed:s.rdir-=g*a*s.speed,s.rdir=s.wdir}}function createStar(r,t,a,e,i){return{x:r,y:t,radius:a,color:e,outColor:i}}function drawStar(r){var t=ctx.createRadialGradient(r.x,r.y,r.radius/1.5,r.x,r.y,r.radius);t.addColorStop(0,r.color),t.addColorStop(1,r.outColor),ctx.fillStyle=t,ctx.beginPath(),ctx.arc(r.x,r.y,r.radius,0,2*Math.PI),ctx.fill()}window.requestAnimationFrame(r=>{previousTime=r,loop(r)}),document.onkeydown=function(r){},document.getElementById("canvas").addEventListener("wheel",onwheel);