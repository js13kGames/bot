var module=noise={};function Grad(t,r,a){this.x=t,this.y=r,this.z=a}Grad.prototype.dot2=function(t,r){return this.x*t+this.y*r},Grad.prototype.dot3=function(t,r,a){return this.x*t+this.y*r+this.z*a};var grad3=[new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)],p=new Array;for(i of atob`l6CJW1oPgw3JX2A1wukH4YwkZx5FjghjJfAVChe+BpT3eOpLABrFPl7828t1IwsgObEhWO2VOFeuFH2Iq6hEr0qlR4aLMBumTZKe51Nv5Xo804Xm3GlcKTcu9Sj0Zo82QRk/oQHYUEnRTIS70FkSqcjEh4J0vJ9WpGRtxq26A0A02eL6fHsFyiaTdn7/UlXUz8474y8QOhG2vRwq37eq1Xf4mAIsmqNG3Zllm6crrAmBFif9E2Jsbk9x4OiyuXBo2vZh5Psi8sHu0pAMv7Oi8VEzkev5Du9rMcDWH7XHap24VMywc3kyLX8Elv6K7M1d3nJDHRhI842Aw05C1z2ctA`)p.push(i.charCodeAt());var perm=new Array(512),gradP=new Array(512);function fade(t){return t*t*t*(t*(6*t-15)+10)}function lerp(t,r,a){return(1-a)*t+a*r}function srandom(){var t=1e4*Math.sin(seed++);return t-Math.floor(t)}function orbit(t,r,a,e,s){var i=2*Math.PI*e,n=orbitSpeed(a,e)/i;return{x:Math.cos(s*n)*e+t,y:Math.sin(s*n)*e+r}}function orbitSpeed(t,r){var a=G()*t;return Math.sqrt(a/r)}function gravity(t){var r={x:0,y:0},a=gravityFrom(t,0,0,sun.mass);r.x+=a.x,r.y+=a.y;for(var e=0;e<planets.length;e++){a=gravityFrom(t,planets[e].x,planets[e].y,planets[e].mass);r.x+=a.x,r.y+=a.y}}function gravityFrom(t,r,a,e){var s=distance2(t.x,t.y,r,a,e),i=normalize(r-t.x,a-t.y),n=G()*(e/s);return{x:i.x*n,y:i.y*n}}function G(){return.5}function randomColor(t,r){var a,e,s;if(0==t){var i=rrg(128,180);a=i,e=i,s=i}else 1==t?rrg(0,100)>=50?(a=rrg(50,170),e=rrg(90,200),s=rrg(80,170)):(a=rrg(100,200),e=rrg(80,170),s=rrg(50,100)):2==t?(a=rrg(100,250),e=rrg(40,100),s=rrg(50,100)):3==t?(a=rrg(50,200),e=rrg(50,200),s=rrg(50,200)):(a=255,e=0,s=255);return"rgb("+a*r+","+e*r+","+s*r+")"}function makeColorAlpha(t){var r=t;return r=(r=r.splice(0,4,"")).splice(t.length-5,2,"")}function rrg(t,r){return Math.floor(t+srandom()*(r+1-t))}function imageDataToImage(t){var r=document.createElement("canvas"),a=r.getContext("2d");r.width=t.width,r.height=t.height,a.putImageData(t,0,0);var e=new Image;return e.src=r.toDataURL(),r.innerHTML="",e}function drawBright(t,r,a,e){var s=ctx.globalCompositeOperation;ctx.globalCompositeOperation="lighter",ctx.translate(t,r),ctx.scale(a,a),ctx.drawImage(brightImage,-brightData.width/2,-brightData.height/2),ctx.scale(1/a,1/a),ctx.translate(-t,-r),ctx.globalCompositeOperation=s}function doCameraTransform(){ctx.translate(canvas.width/2,canvas.height/2),ctx.scale(camera.zoom,camera.zoom),ctx.translate(-camera.x,-camera.y)}function sanitizeAngle(t){var r=t;return Math.abs(r)>=2*Math.PI&&(r%=2*Math.PI),r<=0&&(r=2*Math.PI+r),r}function normalize(t,r){var a=Math.sqrt(t*t+r*r);return{x:t/a,y:r/a}}function distance2(t,r,a,e){let s=t-a,i=r-e;return s*s+i*i}function distance(t,r,a,e){return Math.sqrt(distance2(t,r,a,e))}module.seed=function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var r=0;r<256;r++){var a;a=1&r?p[r]^255&t:p[r]^t>>8&255,perm[r]=perm[r+256]=a,gradP[r]=gradP[r+256]=grad3[a%12]}},module.seed(0),module.perlin2=function(t,r){var a=Math.floor(t),e=Math.floor(r);t-=a,r-=e;var s=gradP[(a&=255)+perm[e&=255]].dot2(t,r),i=gradP[a+perm[e+1]].dot2(t,r-1),n=gradP[a+1+perm[e]].dot2(t-1,r),o=gradP[a+1+perm[e+1]].dot2(t-1,r-1),h=fade(t);return lerp(lerp(s,n,h),lerp(i,o,h),fade(r))},String.prototype.splice||(String.prototype.splice=function(t,r,a){return this.slice(0,t)+a+this.slice(t+Math.abs(r))}),seed=100,noise.seed(seed);let previousTime=0;var time=0,canvas=document.getElementById("canvas");canvas.width=.8*window.innerWidth,canvas.height=.8*window.innerHeight;var starFieldImage,brightImage,ctx=canvas.getContext("2d"),backdropScale=1,starFieldData=ctx.createImageData(canvas.width*backdropScale,canvas.height*backdropScale),brightSize=768,brightData=ctx.createImageData(brightSize,brightSize),sun=createStar(0,0,5e3,"rgb(255, 240, 200)","White");sun.mass=5*Math.PI*sun.radius*sun.radius;var planets=Array(),planetCount=rrg(5,11),ships=Array(),rings=Array(),camera={x:0,y:0,zoom:.5},aimPoint={x:0,y:0},mousePos={x:0,y:0},thrust={fw:0,side:0,rot:0},thrustSpeed=1,mapMode=0,mode=0;function update(t){for(var r=0;r<planets.length;r++){var a,e,s,i=planets[r];-1==i.center?(a=0,e=0,s=sun.mass):(a=planets[i.center].x,e=planets[i.center].y,s=planets[i.center].mass);var n=orbit(a,e,s,i.orbitRadius,time+i.orbitOffset);i.x=n.x,i.y=n.y}simulateShip(ships[0],t),setShipThrust(ships[0],thrust.rot,thrust.fw,thrust.side);var o=orbit(planets[1].x,planets[1].y,planets[0].mass,1200,time+1e3);ships[0].x=o.x,ships[0].y=o.y,aimPoint.x=1*(mousePos.x-canvas.width/2)/camera.zoom+camera.x,aimPoint.y=1*(mousePos.y-canvas.height/2)/camera.zoom+camera.y,aimShipGuns(ships[0],aimPoint,t),camera.x=ships[0].x,camera.y=ships[0].y,time+=10*t}function render(){ctx.setTransform(1,0,0,1,0,0),ctx.putImageData(starFieldData,0,0),doCameraTransform();for(var t=0;t<rings.length;t++)drawRing(rings[t],time);drawBright(0,0,125);for(t=0;t<planets.length;t++)drawPlanet(planets[t]);for(t=0;t<ships.length;t++)drawShip(ships[t]);for(t=0;t<planets.length;t++)drawPlanetShadow(planets[t]);drawStar(sun)}generateStarfield(),generateBright(),generate(),ships.push(createShip(0,2400)),ships[0].x=1e5,ships[0].y=1e5;const loop=t=>{const r=t-previousTime;previousTime=t,update(r/1e3),render(),window.requestAnimationFrame(loop)};function onkey(t){var r="keyup"==t.type;console.log("Key: "+t.code);var a=t.code,e=1;r&&(e=0),0==mode&&("KeyW"==a?thrust.fw=e:"KeyS"==a?thrust.fw=-e:"KeyA"==a?thrust.rot=-e:"KeyD"==a?thrust.rot=e:"KeyQ"==a?thrust.side=-e:"KeyE"==a&&(thrust.side=e))}function onwheel(t){camera.zoom-=.06*camera.zoom*Math.sign(t.deltaY),mapMode=camera.zoom<=.5?1:0}function mousemove(t){var r=getMousePos(canvas,t);mousePos.x=r.x,mousePos.y=r.y}function getMousePos(t,r){var a=t.getBoundingClientRect();return{x:r.clientX-a.left,y:r.clientY-a.top}}function generateBright(){for(var t=0;t<brightSize;t++)for(var r=0;r<brightSize;r++){var a=t*brightSize+r,e=r-brightSize/2,s=t-brightSize/2,i=brightSize/((e*e+s*s)/6),n=i,o=Math.atan2(s,e);n+=.6*noise.perlin2(15*o,0),n-=1-Math.pow(i,.03);var h=Math.max(1-(i-1)*(i-1),0),l=Math.max(1-(i-1.2)*(i-1.2),0),c=Math.max(1-(i-1.4)*(i-1.4),0),d=noise.perlin2(8*o,1)*h+h,u=noise.perlin2(16*o,7)*l+l,x=noise.perlin2(32*o,15)*c+c;brightData.data[4*a+0]=200*n+128*d,brightData.data[4*a+1]=160*n+118*u,brightData.data[4*a+2]=128*n+98*x,brightData.data[4*a+3]=255*n}brightImage=imageDataToImage(brightData)}function generateStarfield(){for(var t=0;t<canvas.height*backdropScale;t++)for(var r=0;r<canvas.width*backdropScale;r++){var a=t*canvas.width*backdropScale+r,e=0,s=0,i=0,n=noise.perlin2(.001*r,.001*t),o=noise.perlin2(.01*r+n,.01*t+n),h=noise.perlin2(.05*r,.05*t),l=noise.perlin2(.01*r+5,.01*t+5);if(s=.7*(e=255*(o+h+n))+60*l,i=.5*e+128*l,rrg(0,1e4)>=9995)e=255,s=255,i=255;else{e*=.25,s*=.25,i*=.25}starFieldData.data[4*a+0]=e,starFieldData.data[4*a+1]=s,starFieldData.data[4*a+2]=i,starFieldData.data[4*a+3]=255}starFieldImage=imageDataToImage(starFieldData)}function generatePlanet(t,r){var a;if(0==t){var e=rrg(250,850)*r;a=createPlanet(rrg(25,60),rrg(140,150),e,0,randomColor(0,1),randomColor(0,.5),randomColor(0,1),"0, 0, 0",rrg(0,1e4),64)}else if(1==t){e=rrg(300,600)*r;a=createPlanet(rrg(25,30),rrg(90,160),e,e+rrg(120,170),randomColor(1,1),randomColor(1,.5),randomColor(1,1),"120, 120, 255",rrg(0,1e4),64)}else if(2==t){e=rrg(350,900)*r;a=createPlanet(rrg(15,25),rrg(80,120),e,e+rrg(120,170),randomColor(2,1),randomColor(2,.5),randomColor(2,1),"255, 120, 120",rrg(0,1e4),64)}else if(3==t){e=rrg(700,1800)*r;var s=randomColor(3,1);a=createGasPlanet(e,e+rrg(50,300),makeColorAlpha(s),s,randomColor(3,1))}else if(4==t){e=rrg(40,120)*r;a=createPlanet(rrg(25,60),rrg(140,150),e,0,randomColor(2,1),randomColor(2,.5),randomColor(2,1),"0, 0, 0",rrg(0,1e4),32)}return a.mass=4*Math.PI*a.radius*a.radius,a}function generate(){for(var t=0;t<planetCount;t++){var r=rrg(0,4),a=rrg(9e3,12e4);1==r&&(a<=4e4||a>=8e4)&&(r=2),(i=generatePlanet(r,1)).orbitRadius=a,i.orbitOffset=rrg(-5e4,5e4),i.center=-1,i.type=r,planets.push(i)}for(t=0;t<planetCount;t++){for(var e=rrg(0,planets[t].radius/350),s=0;s<e;s++){var i;3==(r=rrg(0,4))&&(r=0),(i=generatePlanet(r,.01*rrg(25,60))).radius>=.6*planets[t].radius&&(i.radius*=.5);var n=planets[t].radius+5*i.radius,o=planets[t].orbitRadius/4e3;i.orbitRadius=rrg(n,n+planets[t].radius*o),i.orbitOffset=rrg(0,5e5),i.center=t,i.type=r,planets.push(i)}if(rrg(0,1e3)>=900&&planets[t].radius>=600){var h=rrg(1.5*planets[t].radius,6*planets[t].radius),l=createRing(t,h,h+.01*rrg(0,400)*planets[t].radius,3e-8*rrg(80,400));rings.push(l)}}var c=!1,d=!1,u=!1,x=!1;for(t=0;t<planets.length;t++)1==planets[t].type&&(c=!0),2==planets[t].type&&(u=!0),3==planets[t].type&&(d=!0),4==planets[t].type&&(x=!0);(0==c||0==d||0==u||0==x||rings.length<=1)&&(planets=[],seed+=rrg(1,5e3),generate())}function createPlanet(t,r,a,e,s,i,n,o,h,l){var c=Array(l),d=Array(l);noise.seed(h);for(var u=0;u<l;u++){var x=noise.perlin2(u/l*t*1,0)*r,p=noise.perlin2(u/l*t*2,5)*r*.5,g=noise.perlin2(u/l*t*4,8)*r*.25;c[u]=Math.max(x+p,0),d[u]=noise.perlin2(u/l*t,40)*r+g}return{x:0,y:0,radius:a,atmoRadius:e,colorInner:s,colorOuter:i,colorDetail:n,colorAtmo:o,heights:c,bheights:d,isGasPlanet:!1}}function createGasPlanet(t,r,a,e,s){return{x:0,y:0,radius:t,atmoRadius:r,colorAtmo:a,color0:e,color1:s,isGasPlanet:!0}}function drawAtmosphere(t,r,a,e,s){var i=ctx.createRadialGradient(t,r,a,t,r,e);i.addColorStop(0,"rgba("+s+",0.5)"),i.addColorStop(1,"rgb("+s+", 0)"),ctx.fillStyle=i,ctx.beginPath(),ctx.arc(t,r,e,0,2*Math.PI),ctx.fill()}function drawPlanetShadow(t){var r=t.x*t.x+t.y*t.y,a=Math.sqrt(r+t.radius*t.radius),e=Math.PI/2-Math.atan2(-t.y,-t.x),s=Math.acos(t.radius/a),i=e-s,n=e+s,o=1*t.radius;0!=t.atmoRadius&&(o=t.atmoRadius);var h=t.x+Math.sin(i)*o,l=t.y+Math.cos(i)*o,c=t.x+Math.sin(n)*o,d=t.y+Math.cos(n)*o,u=32*t.radius,x=Math.sqrt(h*h+l*l),p=Math.sqrt(c*c+d*d),g=Math.sqrt(r),y=h/x,m=l/x,f=c/p,v=d/p,M=ctx.createLinearGradient(t.x,t.y,t.x+t.x/g*u,t.y+t.y/g*u),P=.005+Math.max((t.atmoRadius-t.radius)/32e3,0);M.addColorStop(0,"rgba(0, 0, 0, 0)"),M.addColorStop(P,"rgba(0, 0, 0, 0.8)"),M.addColorStop(1,"rgba(0, 0, 0, 0)"),ctx.fillStyle=M,ctx.beginPath(),ctx.moveTo(h,l),ctx.lineTo(h+y*u,l+m*u),ctx.lineTo(c+f*u,d+v*u),ctx.lineTo(c,d),ctx.closePath(),ctx.fill()}function drawPlanet(t){if(1==t.isGasPlanet)ctx.fillStyle=t.color0,ctx.beginPath(),ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),ctx.fill(),drawAtmosphere(t.x,t.y,t.radius,t.atmoRadius,t.colorAtmo);else{ctx.fillStyle=t.colorOuter,ctx.beginPath();for(var r=t.heights.length,a=0;a<r;a++){var e=a/r*2*Math.PI,s=Math.cos(e),i=Math.sin(e),n=t.bheights[a]+15;s=s*t.radius+s*n+t.x,i=i*t.radius+i*n+t.y,0==a?ctx.moveTo(s,i):ctx.lineTo(s,i)}ctx.closePath(),ctx.fill(),t.atmoRadius>=0&&drawAtmosphere(t.x,t.y,t.radius,t.atmoRadius,t.colorAtmo),ctx.fillStyle=t.colorInner,ctx.beginPath();for(r=t.heights.length,a=0;a<r;a++){e=a/r*2*Math.PI,s=Math.cos(e),i=Math.sin(e),n=t.heights[a]+5;s=s*t.radius+s*n+t.x,i=i*t.radius+i*n+t.y,0==a?ctx.moveTo(s,i):ctx.lineTo(s,i)}ctx.closePath(),ctx.fill(),ctx.fillStyle=t.colorDetail,ctx.beginPath(),ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),ctx.fill()}}function createRing(t,r,a,e){var s=(Math.PI*a*a-Math.PI*r*r)*e,i=Array();s>=64&&(s=64);for(var n=0;n<s;n++){var o=rrg(r,a),h=rrg(-1e4,1e4),l=rrg(5,50),c=randomColor(2,.6);i.push({orbitRadius:o,offset:h,size:l,color:c})}return{center:t,minRadius:r,maxRadius:a,rocks:i}}function distance(t,r,a,e){var s=a-t,i=e-r;return Math.sqrt(s*s+i*i)}function maxCameraReach(){return Math.max(canvas.width,canvas.height)/camera.zoom}function drawRing(t,r){var a=planets[t.center].x,e=planets[t.center].y;if(camera.zoom>=.01&&distance(camera.x,camera.y,a,e)<=maxCameraReach()+t.maxRadius)for(var s=0;s<t.rocks.length;s++){var i=t.rocks[s],n=orbit(a,e,planets[t.center].mass,i.orbitRadius,r+i.offset);ctx.fillStyle=i.color,ctx.beginPath(),ctx.arc(n.x,n.y,i.size,0,2*Math.PI),ctx.fill()}}function createShip(t,r){let a=[1,10,50,100,50,.5,6,100,200,150,.2,2,400,250,80];seed=r;var e,s={},i=Array(),n=Array(),o=Array();if(0==t){var h=(e=(p=.5*rrg(50,100))*rrg(100,140)*.01)/(2*p);i.push({x:-p/2,y:0}),i.push({x:p/2,y:0}),i.push({x:0,y:e}),i.push({x:.5*e*h,y:.5*e}),i.push({x:.8*p,y:.5*e}),i.push({x:.8*-p,y:.5*e}),i.push({x:0,y:2*e}),i.push({x:.8*p,y:.5*e}),i.push({x:.5*e*h,y:.5*e}),i.push({x:0,y:e});var l=p*rrg(30,70)*.005;o.push({x:-l,y:0,size:6,t:0,dir:0}),o.push({x:l,y:0,size:6,t:0,dir:0}),o.push({x:0,y:2*e,size:6,t:0,dir:Math.PI}),o.push({x:0,y:2*e,size:6,t:0,dir:Math.PI/2}),o.push({x:0,y:2*e,size:6,t:0,dir:-Math.PI/2}),o.push({x:l,y:0,size:6,t:0,dir:Math.PI/2}),o.push({x:-l,y:0,size:6,t:0,dir:-Math.PI/2});var c=(x=rrg(60,90)*e*.01)*h*.5;n.push({x:c,y:x,dir:0,size:12,angle:Math.PI/2.5,speed:8}),n.push({x:-c,y:x,dir:0,size:12,angle:Math.PI/2.5,speed:8})}else if(1==t){var d=(e=(p=.5*rrg(100,160))*rrg(140,180)*.01)*rrg(130,170)*.01,u=d-e;i.push({x:-p/2,y:0}),i.push({x:p/2,y:0}),i.push({x:p/2,y:e}),i.push({x:-p/2,y:e}),i.push({x:p/8,y:e}),i.push({x:p/8,y:d}),i.push({x:-p/8,y:d}),i.push({x:-p/8,y:e}),i.push({x:-p/2,y:e});l=p*rrg(30,70)*.05,l=p*rrg(30,70)*.005;o.push({x:-l,y:0,size:12,t:0,dir:0}),o.push({x:l,y:0,size:12,t:0,dir:0}),o.push({x:0,y:.8*u+e,size:7,t:0,dir:Math.PI}),o.push({x:0,y:.8*u+e,size:7,t:0,dir:Math.PI/2}),o.push({x:0,y:.8*u+e,size:7,t:0,dir:-Math.PI/2}),o.push({x:l,y:0,size:7,t:0,dir:Math.PI/2}),o.push({x:-l,y:0,size:7,t:0,dir:-Math.PI/2});var x=rrg(70,100)*e*.01;c=rrg(50,80)*p*.005;n.push({x:c,y:x,dir:0,size:16,angle:Math.PI/2,speed:4}),n.push({x:-c,y:x,dir:0,size:16,angle:Math.PI/2,speed:4});x=rrg(30,60)*e*.01,c=rrg(50,80)*p*.005;n.push({x:c,y:x,dir:-Math.PI/2,size:24,angle:Math.PI/2,speed:2}),n.push({x:-c,y:x,dir:Math.PI/2,size:24,angle:Math.PI/2,speed:2})}else if(2==t){var p;e=(p=.5*rrg(180,260))*rrg(200,320)*.01;var g=p*rrg(40,70)*.01,y=rrg(30,60)*e*.01;i.push({x:p/2,y:0}),i.push({x:g/2,y:y}),i.push({x:p/2,y:e}),i.push({x:0,y:1.1*e}),i.push({x:-p/2,y:e}),i.push({x:-g/2,y:y}),i.push({x:-p/2,y:0}),o.push({x:0,y:0,size:20,t:0,dir:0}),o.push({x:p/2.2,y:0,size:14,t:0,dir:0}),o.push({x:-p/2.2,y:0,size:14,t:0,dir:0}),o.push({x:.5*-g,y:y,size:12,t:0,dir:-Math.PI/2}),o.push({x:.5*g,y:y,size:12,t:0,dir:Math.PI/2}),o.push({x:.5*-g,y:y,size:12,t:0,dir:1.15*Math.PI}),o.push({x:.5*g,y:y,size:12,t:0,dir:1.15*-Math.PI}),n.push({x:0,y:y,dir:0,size:32,angle:Math.PI/2,speed:2}),n.push({x:g/2.2,y:1.8*y,dir:-Math.PI/2.5,size:20,angle:Math.PI/2,speed:2}),n.push({x:-g/2.2,y:1.8*y,dir:Math.PI/2.5,size:20,angle:Math.PI/2,speed:2}),n.push({x:g/1.8,y:.95*e,dir:0,size:20,angle:Math.PI/2.5,speed:4}),n.push({x:-g/1.8,y:.95*e,dir:0,size:20,angle:Math.PI/2.5,speed:4})}return s.maneouver=a[5*t+0],s.speed=a[5*t+1],s.armor=a[5*t+2],s.fuel=a[5*t+3],s.cargo=a[5*t+4],{type:t,stats:s,hull:i,weapons:n,thrusters:o,length:e,x:0,y:0,rot:Math.PI,angspeed:0,speed:{x:0,y:0}}}function drawShip(t){ctx.translate(t.x,t.y),ctx.scale(.25,.25),ctx.rotate(t.rot),ctx.translate(0,-t.length/2),ctx.fillStyle="rgb(100, 100, 100)",ctx.strokeStyle="rgb(255, 255, 255)",ctx.lineWidth=2,ctx.beginPath();for(var r=0;r<t.hull.length;r++)0==r?ctx.moveTo(t.hull[r].x,t.hull[r].y):ctx.lineTo(t.hull[r].x,t.hull[r].y),r==t.hull.length-1&&ctx.lineTo(t.hull[0].x,t.hull[0].y);ctx.fill(),ctx.stroke();for(r=0;r<t.thrusters.length;r++){ctx.fillStyle="rgb(60, 60, 60)",ctx.strokeStyle="rgb(255, 255, 255)",ctx.lineWidth=2;var a=t.thrusters[r],e=a.size,s=Math.cos(a.dir-Math.PI/2),i=Math.sin(a.dir-Math.PI/2),n=Math.cos(a.dir),o=Math.sin(a.dir),h=s*e*2+n*e*.7,l=i*e*2+o*e*.7,c=s*e*2-n*e*.7,d=i*e*2-o*e*.7;ctx.beginPath(),ctx.moveTo(a.x,a.y),ctx.lineTo(a.x+h,a.y+l),ctx.lineTo(a.x+c,a.y+d),ctx.lineTo(a.x,a.y),ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.arc(a.x,a.y,e,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.fillStyle="rgb(255, 255, 255)",ctx.strokeStyle="rgb(180, 180, 255)",ctx.lineWidth=4;var u=8*(a.t+.05);ctx.beginPath(),ctx.lineTo(a.x+h,a.y+l),ctx.lineTo(a.x+s*(u+2)*e,a.y+e*(u+2)*i),ctx.lineTo(a.x+c,a.y+d),ctx.fill(),ctx.stroke()}for(r=0;r<t.weapons.length;r++){ctx.fillStyle="rgb(170, 90, 90)",ctx.strokeStyle="rgb(255, 255, 255)",ctx.lineWidth=2;var x=t.weapons[r],p=x.size;ctx.beginPath(),ctx.rect(x.x-p/2,x.y-p/2,p,p),ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.lineWidth=4,ctx.moveTo(x.x,x.y);var g=1.5*p;ctx.lineTo(x.x+g*Math.cos(x.rdir+Math.PI/2-t.rot),x.y+g*Math.sin(x.rdir+Math.PI/2-t.rot)),ctx.stroke()}ctx.setTransform(1,0,0,1,0,0),doCameraTransform()}function xvals(t){var r=0,a=0;return t>=0?r=t:a=-t,{a:r,b:a}}function setShipThrust(t,r,a,e){var s=xvals(r),i=xvals(e),n=xvals(a);2==t.type?(t.thrusters[0].t=n.a,t.thrusters[2].t=Math.max(s.b,a),t.thrusters[1].t=Math.max(s.a,a),t.thrusters[3].t=i.b,t.thrusters[4].t=i.a,t.thrusters[5].t=n.b,t.thrusters[6].t=n.b):(t.thrusters[0].t=n.a,t.thrusters[1].t=n.a,t.thrusters[2].t=n.b,t.thrusters[3].t=Math.max(i.a,s.a),t.thrusters[4].t=Math.max(i.b,s.b),t.thrusters[5].t=Math.max(i.a,s.b),t.thrusters[6].t=Math.max(i.b,s.a))}function aimShipGuns(t,r,a){t.rot=sanitizeAngle(t.rot);for(var e=r.x-t.x,s=r.y-t.y,i=0;i<t.weapons.length;i++){var n=t.weapons[i];n.dir=sanitizeAngle(n.dir);var o=Math.cos(t.rot+n.dir+Math.PI/2),h=Math.sin(t.rot+n.dir+Math.PI/2),l=n.dir+t.rot,c=Math.atan2(s-h,e-o),d=Math.atan2(s,e)-Math.atan2(h,o);d>Math.PI?d-=2*Math.PI:d<=-Math.PI&&(d+=2*Math.PI),Math.abs(d)<=n.angle?(n.wdir=c-.5*Math.PI,n.aim=!0):(n.wdir=l,n.aim=!1),null==n.rdir&&(n.rdir=l),n.rdir=n.wdir}}function simulateShip(t,r){gravity({x:t.x,y:t.y});t.angspeed+=t.stats.maneouver*r*thrust.rot,t.x+=t.speed.x*r,t.y+=t.speed.y*r,t.rot+=t.angspeed*r}function createStar(t,r,a,e,s){return{x:t,y:r,radius:a,color:e,outColor:s}}function drawStar(t){var r=ctx.createRadialGradient(t.x,t.y,t.radius/1.5,t.x,t.y,t.radius);r.addColorStop(0,t.color),r.addColorStop(1,t.outColor),ctx.fillStyle=r,ctx.beginPath(),ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),ctx.fill()}window.requestAnimationFrame(t=>{previousTime=t,loop(t)}),document.getElementById("canvas").addEventListener("wheel",onwheel),document.getElementById("canvas").addEventListener("mousemove",mousemove,!1),document.onkeydown=document.onkeyup=onkey;