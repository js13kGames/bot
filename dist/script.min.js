var aa=Math.floor(1e4*Math.random()),ba=noise={};function g(a,e,t){this.x=a,this.y=e,this.z=t}function ca(a,e,t){return a.x*e+a.y*t}for(var da=[new g(1,1,0),new g(-1,1,0),new g(1,-1,0),new g(-1,-1,0),new g(1,0,1),new g(-1,0,1),new g(1,0,-1),new g(-1,0,-1),new g(0,1,1),new g(0,-1,1),new g(0,1,-1),new g(0,-1,-1)],ea=Array(256),m=0;256>m;m++)ea[m]=n(0,255);var p=Array(512),u=Array(512);ba.Ia=function(a){0<a&&1>a&&(a*=65536),256>(a=Math.floor(a))&&(a|=a<<8);for(var e=0;256>e;e++){var t=1&e?ea[e]^255&a:ea[e]^a>>8&255;p[e]=p[e+256]=t,u[e]=u[e+256]=da[t%12]}},ba.Ia(0),ba.v=function(a,e){var t=Math.floor(a),n=Math.floor(e),r=(a-=t)*a*a*(a*(6*a-15)+10),i=(e-=n)*e*e*(e*(6*e-15)+10);return(1-i)*((1-r)*ca(u[(t&=255)+p[n&=255]],a,e)+r*ca(u[t+1+p[n]],a-1,e))+i*((1-r)*ca(u[t+p[n+1]],a,e-1)+r*ca(u[t+1+p[n+1]],a-1,e-1))},noise.Ia(aa);var fa={A:[[1,1,1],[1,0,1],[1,0,1],[1,1,1],[1,0,1]],B:[[1,1],[1,0,1],[1,1,1],[1,0,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,0,1],[1,0,1],[1,0,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,0,1,1],[1,0,0,1],[,1,1]],H:[[1,0,1],[1,0,1],[1,1,1],[1,0,1],[1,0,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,0,1],[,0,1],[1,0,1],[1,1,1]],K:[[1,0,0,1],[1,0,1],[1,1],[1,0,1],[1,0,0,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1]],N:[[1,0,0,1],[1,1,0,1],[1,0,1,1],[1,0,0,1],[1,0,0,1]],O:[[1,1,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]],P:[[1,1,1],[1,0,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,0,0,1],[1,0,0,1],[1,0,1,1],[1,1,1,1]],R:[[1,1,1],[1,0,1],[1,0,1],[1,1],[1,0,1]],S:[[1,1,1],[1],[1,1,1],[,0,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,0,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]],V:[[1,0,0,0,1],[1,0,0,0,1],[,1,0,1],[,1,0,1],[,0,1]],W:[[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,1,1,1,1]],X:[[1,0,0,0,1],[,1,0,1],[,0,1],[,1,0,1],[1,0,0,0,1]],Y:[[1,0,1],[1,0,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,0,0,1],[,0,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,0,1],[1,0,1],[1,0,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]],":":[[,,],[,1],[,,],[,1],[,,]],"/":[[0,0,1],[0,1,0],[0,1,0],[0,1,0],[1,0,0]]," ":[[,0],[,0],[,0],[,0],[,0]],"%":[[0,0,0,1,0],[1,0,1,0,0],[0,0,1,0,0],[0,0,1,0,1],[0,1,0,0,0]],",":[[,,],[,,],[,,],[,1],[1,,]]};function ha(a){var e=[];a=a.toUpperCase();for(var t=0;t<a.length;t++){var n=fa[a.charAt(t)];null!=n&&e.push(n)}return e}function ia(a){a=ha(a);for(var e=0,t=0;t<a.length;t++){for(var n=a[t],r=0,i=0;i<n.length;i++)r=Math.max(r,2*n[i].length);e+=2+r}return e}function v(a,e,t,n,r){a=ha(a),y.fillStyle=r;for(var i=r=0;i<a.length;i++){for(var l=a[i],o=0,h=0,b=0;b<l.length;b++){for(var s=l[b],f=0;f<s.length;f++)s[f]&&y.fillRect(f*n+r+e,o+t,n,n);h=Math.max(h,s.length*n),o+=n}r+=n+h}return r}function z(){var a=1e4*Math.sin(aa++);return a-Math.floor(a)}function A(a,e){var t=B[a];if(0==a)return{x:0,y:0};if(0==t.l)return C(0,0,B[t.l].m,t.m,t.$,e+t.ja);var n=A(t.l,e);return C(n.x,n.y,B[t.l].m,t.m,t.$,e+t.ja)}function C(a,e,t,n,r,i){return t=Math.sqrt(2.5*(t+n)/r)/r,{x:Math.cos(i*t)*r+a,y:Math.sin(i*t)*r+e}}function ja(a,e,t,n,r,i){var y=C(a,e,t,n,r,i);return y=D((a=C(a,e,t,n,r,i+.01)).x-y.x,a.y-y.y),t=Math.sqrt(2.5*(t+n)/r),y.x*=t,y.y*=t,y}function E(a,e,t,n,r){if(0==a)return 0==t?{x:0,y:0}:ja(0,0,B[0].m,e,t,n+r);a=B[a];var i=ja(B[a.l].x,B[a.l].y,B[a.l].m,a.m,a.$,n+a.ja),y=E(a.l,e,0,n,r);return i={x:i.x+y.x,y:i.y+y.y},0==t?i:(e=ja(a.x,a.y,a.m,e,t,n+r),{x:i.x+e.x,y:i.y+e.y})}function ka(a,e){var t={x:0,y:0};if(-1===e)for(var n=0;n<B.length;n++){var r=B[n];r=la(a,r.x,r.y,B[n].m),t.x+=r.x,t.y+=r.y}else for(n=0;n<B.length;n++)r=la(a,(r=A(n,e)).x,r.y,B[n].m),t.x+=r.x,t.y+=r.y;return t}function ma(a,e){for(var t=0;t<B.length;t++){var n=A(t,e);if(F(a.x,a.y,n.x,n.y)<=1.02*B[t].a)return{f:t,ua:(n=D(a.x-n.x,a.y-n.y)).x*B[t].a*1.02,va:n.y*B[t].a*1.02,tb:n.x,ub:n.y}}return null}function na(a,e,t){var n=G;a:{var r=ma(a,n);if(null!=r){var i=B[r.f];if(null!=i.j)for(var y=0;y<i.j.length;y++){var l=i.j[y],o=l.x*i.a*.98+i.x,h=l.y*i.a*.98+i.y;if(F(o,h,a.x,a.y)<=2*l.size){r={Ja:l,ia:y,f:r.f,vb:o,wb:h};break a}}}r=null}n=ma(a,n);a:{for(e=void 0===(e=void 0===e?-1:e)?-1:e,t=void 0===(t=void 0===t?1:t)?1:t,i=0;i<H.length;i++)if(((0==(y=H[i].g)?1==e:e!=y)||-1==e)&&(y=5,1==H[i].type?y=14:2==H[i].type&&(y=28),F(a.x,a.y,H[i].x,H[i].y)<=y*t)){H[i].ia=i,a=H[i];break a}a=null}return{Ja:r,f:n,ka:a}}function la(a,e,t,n){var r=D(e-a.x,t-a.y);return n=n/((e=a.x-e)*e+(a=a.y-t)*a)*2.5,{x:r.x*n,y:r.y*n}}function oa(a){var e=n(0,100),t=n(0,5);return pa(50>=e?0:90>=e?1:2,z(),a,t)}function I(a,e){var t,r;if(0==a)var i=t=r=n(128,180);else 1==a?50<=n(0,100)?(t=n(50,170),i=n(90,200),r=n(80,170)):(t=n(100,200),i=n(80,170),r=n(50,100)):2==a?(t=n(100,250),i=n(40,100),r=n(50,100)):3==a?(t=n(50,200),i=n(50,200),r=n(50,200)):(t=n(0,255),i=n(0,255),r=n(0,255));return"rgb("+t*e+","+i*e+","+r*e+")"}function qa(a){var e=G;return a==B[0]?{x:0,y:0}:E(a.l,a.m,a.$,e,a.ja)}function ra(a){if(0==a)var e=(a=n(80,160))*n(80,100)*.01,t=a*n(100,130)*.01;else 1==a?(e=(a=n(120,210))*n(40,90)*.01,t=a*n(20,50)*.01):t=e=a=n(80,110);return"rgb("+a+","+e+","+t+")"}function n(a,e){return Math.floor(a+z()*(e+1-a))}function sa(a){var e=document.createElement("canvas"),t=e.getContext("2d");return e.width=a.width,e.height=a.height,t.putImageData(a,0,0),(a=new Image).src=e.toDataURL(),e.innerHTML="",a}function ta(a,e,t){var n=y.globalCompositeOperation;y.globalCompositeOperation="lighter",y.translate(a,e),y.scale(t,t),y.drawImage(ua,-J.width/2,-J.height/2),y.scale(1/t,1/t),y.translate(-a,-e),y.globalCompositeOperation=n}function va(){y.setTransform(1,0,0,1,0,0),y.translate(K.width/2,K.height/2),wa&&y.rotate(-H[0].b-Math.PI),y.scale(L,L),y.translate(-xa,-ya)}function za(a){return Math.abs(a)>=2*Math.PI&&(a%=2*Math.PI),0>=a&&(a=2*Math.PI+a),a}function Aa(a,e){var t=a-e;return t>Math.PI&&(t=-2*Math.PI+t),t}function Ba(a){return 0==a?"Free":isNaN(a)?"":a.toString()}function D(a,e){var t=Math.sqrt(a*a+e*e);return{x:a/t,y:e/t}}function F(a,e,t,n){return a-=t,e-=n,Math.sqrt(a*a+e*e)}function Ca(a,e,t){var n=Math.atan2(e,a);return n+=t,{x:(a=Math.sqrt(a*a+e*e))*Math.cos(n),y:a*Math.sin(n)}}function Da(a,e){a.h.xa={target:e,type:0}}function Ea(a,e){a.frame=e,a.h.Aa={type:0,Ga:0}}function Fa(a,e,t){a.frame=e,a.h.Aa={type:1,a:t,Ua:!1,Va:!1,Ha:4,$a:0}}function Ga(a,e,t){var n=Aa(za(a.b),t.target);e=Math.abs(Aa(za(a.b+a.ha*e),t.target))-Math.abs(n);var r=1;return 1>=Math.abs(n)&&(r=Math.max(1*Math.abs(n)*Math.abs(n),.6)),0>e?Math.abs(a.ha)>=Math.min(2*Math.abs(n),1)&&(a.c.b=Math.abs(n)<=Math.PI/4?-Math.sign(n)*r*.1:0):a.c.b=-Math.sign(n)*r*1.4,.01>=Math.abs(n)&&.1>=Math.abs(a.ha)&&(a.ha=0,a.b=t.target,a.c.b=0),Math.abs(n)}function M(a,e,t,r,i,y,l,o,h){h=void 0===h?.5:h,Ha.push({x:a,y:e,la:t,ma:r,time:0,size:i,speed:y,bb:l,fb:!0}),t=i/100,h=void 0===h?.6:h,a=Math.min(Math.max(500/(10*F(xa,ya,a,e)),.005),1),e=.05+1.7*t,r=Math.min(100/(460*Math.pow(t,2.6)),500),o||(e=.1+.67*t,r=n(150-.14*t,280-.14*t)),a*=h,zzfx(Math.min(4*a,1),0,n(r-200*t,2*r),e,-5,0,8,0,.81),o&&zzfx(Math.min(a*t*2,1),0,n(r,r+100),n(1,.1*t)*t*e*2,0,0,8,0,0)}String.prototype.splice||(String.prototype.splice=function(a,e,t){return this.slice(0,a)+t+this.slice(a+Math.abs(e))}),zzfx_v=.5,zzfx_x=new AudioContext,zzfx=function(a,e,t,n,r,i,y,l,o){var h=Math.PI;t=2*h/44100*t*(1+e*(2*Math.random()-1)),i*=1e3*h/Math.pow(44100,2),r*=0|(n=0<n?44100*(10<n?10:n)|0:1),l*=2*h/44100,o*=h,e=[];for(var b=h=0,s=0;s<n;++s)e[s]=a*zzfx_v*Math.cos(h*t*Math.cos(b*l+o))*(s<r?s/r:1-(s-r)/(n-r)),h+=1+y*(2*Math.random()-1),b+=1+y*(2*Math.random()-1),t+=i;return a=zzfx_x.createBuffer(1,n,44100),t=zzfx_x.createBufferSource(),a.getChannelData(0).set(e),t.buffer=a,t.connect(zzfx_x.destination),t.start(),t};var Ia="Lygkos;Lithos;Guamedo;Eadu;Anoth;Dikti;Big Iron;Impetu".split(";"),Ja="Delphi;Trapani;Erytrae;Gaia;Boston;Jericho;Nile;New London".split(";"),Ka="Bespin;Nuvo;New Jupiter;Vol;Lightbulb;Big Boy".split(";"),La="Rhodes;New Jairo;Jakku;Savareen;Arrakis;New Sahara".split(";"),Ma=0,G=0,K=document.getElementById("canvas");K.width=1*window.innerWidth,K.height=1*window.innerHeight;for(var Oa,ua,Sa,y=K.getContext("2d"),N=Math.floor(Math.max(K.width,K.height)*(1+Math.sqrt(2))),Na=y.createImageData(N,N),J=y.createImageData(768,768),B=[],Pa=n(9,14),Ha=[],Qa=[],Ra=[],H=[],Ta=[],xa=0,ya=0,L=.5,O={x:0,y:0},Ua=0,Va=0,Wa=0,P=1,Q=0,wa=!1,Xa=[0,1,2,4,10,25,50,100],R=0,S=0,T="",U=0,V=5e3,Ya=!1,Za=!1,$a=[1,1,1],ab=[0,0,0],bb=n(0,1e4),W=0;W<N;W++)for(var X=0;X<N;X++){var cb=W*N+X,db=0,eb=0,fb=0,gb=noise.v(.001*X,.001*W),hb=noise.v(.01*X+5,.01*W+5);eb=.7*(db=255*(noise.v(.01*X+gb,.01*W+gb)+noise.v(.05*X,.05*W)+gb))+60*hb,fb=.5*db+128*hb,9995<=n(0,1e4)?fb=eb=db=255:(db*=.25,eb*=.25,fb*=.25),Na.data[4*cb]=.6*db,Na.data[4*cb+1]=.6*eb,Na.data[4*cb+2]=.6*fb,Na.data[4*cb+3]=255}Oa=sa(Na);for(var ib=0;768>ib;ib++)for(var jb=0;768>jb;jb++){var kb=768*ib+jb,nb=jb-384,ob=ib-384,Y=768/((nb*nb+ob*ob)/6),pb=Y,qb=Math.atan2(ob,nb);pb+=.6*noise.v(15*qb,0),pb-=1-Math.pow(Y,.03);var rb=Math.max(1-(Y-1)*(Y-1),0),sb=Math.max(1-(Y-1.2)*(Y-1.2),0),tb=Math.max(1-(Y-1.4)*(Y-1.4),0),ub=noise.v(16*qb,7)*sb+sb,vb=noise.v(32*qb,15)*tb+tb;J.data[4*kb]=200*pb+128*(noise.v(8*qb,1)*rb+rb),J.data[4*kb+1]=160*pb+118*ub,J.data[4*kb+2]=128*pb+98*vb,J.data[4*kb+3]=255*pb}ua=sa(J),wb(),Sa.name="The Sun";var xb=1;for(m=0;m<B.length;m++)if(1==B[m].type){xb=m,B[m].name="New Earth",B[m].j=[],yb(B[m],.5,0);break}H.push(pa(0,bb,2,$a[0]));var zb=H[0],Ab=C(B[xb].x,B[xb].y,B[xb].m,.001,800,G+0),Bb=E(xb,.001,800,G,0);zb.x=Ab.x,zb.y=Ab.y,zb.speed.x=Bb.x,zb.speed.y=Bb.y,H[0].s=[],H[0].frame=xb;var Cb=!1,Db=!1,Eb=0,Z=-1,Fb=0,Gb=-1,Hb=!1,Ib=0,Jb=!1;function Kb(){for(var a=Q,e=0;e<P;e++){Ib-=a=Q,Lb=!1;for(var t=1;t<B.length;t++){var r=B[t];Mb(r,a);var i=C(B[r.l].x,B[r.l].y,B[r.l].m,r.m,r.$,G+r.ja);r.x=i.x,r.y=i.y}if(Lb?Nb=2:(Nb=0,null!=H[0]&&H[0].ea&&(Nb=1)),0<Q){for(t=0;t<H.length;t++)if(null!=(r=H[t])){if(0<t){i=r;var y=a,l=noise.v(i.h.wa+3*G,i.h.wa+2*G)*i.h.ya;if(-1!=i.h.target&&!i.Da){var o=H[i.h.target];if(null!=o){var h={x:o.x,y:o.y};h.x+=(o.speed.x-i.speed.x)*l,h.y+=(o.speed.y-i.speed.y)*l,Ob(i,h)}}if(l=1e3,i.h.wa-=y,0>=i.h.wa){for(1==i.g&&700<=n(0,1e3)&&(i.h.target=0),i.h.target=-1,o=0;o<H.length;o++){h=i.g;var b=H[o].g;(0==h?1==b:b!=h)&&600<=n(0,1e3)&&(found=!0,i.h.target=o)}i.h.wa=-1==i.h.target?n(1,5):n(3,16)}if(i.Ea=-1!=i.h.target,null!=i.h.xa&&0==i.h.xa.type&&(l=Ga(i,y,i.h.xa)),null!=i.h.Aa)if(0==(o=i.h.Aa).type)Da(i,Pb(i)+Math.PI),h=i.c.o,.02>=l&&10<=Qb(i)&&0>=o.Ga?i.c.o=1:(i.c.o=0,200>=Rb(i)&&0!=h&&(o.Ga=1)),o.Ga-=y,i.ea&&(i.h.Aa=null,i.h.xa=null,i.c.o=0);else if(1==o.type){h=Rb(i),b=Sb(i);var s=B[i.frame];o.Va?(o.Ha-=y,0>=o.Ha&&(Tb(i),o.Ha=4),Da(i,Pb(i)),10>h&&Fa(i,i.frame,1.4*o.a),i.ea&&(i.frame=i.aa.f,Fa(i,i.aa.f,1.4*o.a)),.1>l?h<.8*o.a?i.c.g=-.05:h>1.2*o.a?i.c.g=.05:(i.c.g=0,i.c.o=0):(i.c.o=0,i.c.g=0)):o.Ua?(Da(i,o.angle),i.c.o=1,Qb(i)>=Math.sqrt(2.5*(B[i.frame].m+.001)/b)&&(o.a=h,i.c.o=0,o.Va=!0)):h<=o.a/2?(Da(i,Math.atan2(i.y-s.y,i.x-s.x)-Math.PI/2),i.c.o=1):h>=o.$a?(Da(i,Math.atan2(i.y-s.y,i.x-s.x)),i.c.o=0):(null==o.angle&&(o.angle=Math.atan2(i.y-s.y,i.x-s.x)),Da(i,o.angle),i.c.o=0,.1>=(l=Ga(i,y,i.h.xa))&&(o.Ua=!0)),o.$a=h}}else Ob(r,O);Ub(r,a)&&0!=t&&(H.splice(t,1),(r=Math.abs(Z+1))==t&&(Z=-1),t--)}for(t=0;t<Ha.length;t++)i=a,(r=Ha[t]).time+=i*r.speed,r.x+=r.la*i,r.y+=r.ma*i,1<=r.time&&(Ha.splice(t,1),t--);for(t=0;t<Ra.length;t++)i=a,(r=Ra[t]).time+=i*r.speed,r.x+=r.la*i,r.y+=r.ma*i,1<=r.time&&(Ra.splice(t,1),t--);for(t=0;t<Qa.length;t++)l=a,(r=Qa[t]).x+=r.la*l,r.y+=r.ma*l,i=ka(r,G),r.la+=i.x*l,r.ma+=i.y*l,i=r.size,null!=(y=na(r,r.g)).ka?(M(r.x,r.y,y.ka.speed.x,y.ka.speed.y,17*r.size,2.4,.4,!1),y.ka.i-=i,y.ka.i=Math.floor(y.ka.i),r=!0):null!=y.f?(l=y.f,h=E((o=B[l.f]).l,o.m,o.$,G,o.ja),M(r.x,r.y,h.x,h.y,17*r.size,2.4,.4,!1),null!=y.Ja&&2==r.g&&(l=y.Ja,(r=(o=B[l.f]).j[l.ia]).i-=.5*i,0>=o.fa&&(o.Ta=!0),o.fa=60,0>=r.i&&(M(l.vb,l.wb,h.x,h.y,7*r.size,1.5,1,!1),o.j.splice(l.ia,1),o.Na=Vb(o))),r=!0):(r.Qa-=l,r=0>=r.Qa),r&&(Qa.splice(t,1),t--);G+=a}}if(0<Q&&((O={x:Ua,y:Va}).x-=K.width/2,O.y-=K.height/2,wa&&(e=Ca(O.x,O.y,H[0].b+Math.PI),O.x=e.x,O.y=e.y),O.x*=1/L,O.y*=1/L,O.x+=xa,O.y+=ya,0>Z?(r=Math.abs(Z+1),null!=H[r]&&(xa=H[r].x,ya=H[r].y)):(xa=B[Z].x,ya=B[Z].y),e=na(O,-1,.5/L),Cb&&null!=e.f&&H[0].frame!=e.f.f&&(H[0].frame=e.f.f,T="Reference frame set to "+B[e.f.f].name,S=2),Db&&(t=Z,null!=e.ka?Z=-(e.ka.ia+1):null!=e.f&&(Z=e.f.f),t!=Z&&(0>Z?(r=Math.abs(Z+1),t="player",0==H[r].g?t="human":1==H[r].g&&(t="ai"),T="Focusing on "+t+" ship"):T="Focusing on "+B[Z].name,S=2)),null==e.f?(Fb=0,Gb=-1):e.f.f!=Gb&&(Fb=0,Gb=e.f.f),0>Eb||0!=H[0].c.o||0!=H[0].c.g?(Tb(H[0]),Eb=.5):Eb-=a,Wb-=Wb*Q*3,.1>=Math.abs(Wb)&&(Wb=0),Wa=.16>=(L+=L*Wb*Q*.8)?Math.max(Math.min(.02/L,1),0):0,Fb+=a,S-=a,Jb||(T="Please read the manual",S=5,Jb=!0),!Xb&&(Yb=.07,0==Nb?Zb=$b:1==Nb?Zb=ac:2==Nb&&(Zb=bc,Yb=.11),0>=(cc-=a))))for(cc=ec,4*++dc>Zb.length-1&&(dc=0),a=0;4>a;a++)e=3==a?3:0,t=3==a?ec/2:1.3*ec,t=0==a?2.1*ec:t,0!=(r=fc[Zb[4*dc+a]])&&zzfx(Yb,0,r,t,0,0,e,0,0)}P=0;var gc=0,hc=0;function ic(a){var e=a-Ma;for(Ma=a,Q=e/1e3,Kb(),hc=gc=0,y.setTransform(1,0,0,1,0,0),y.translate(K.width/2,K.height/2),wa&&y.rotate(-H[0].b-Math.PI),y.translate(-N/2-K.height/2,-N/2-K.width/2),y.drawImage(Oa,0,0),va(),a=0;a<Ta.length;a++){e=Ta[a];var t=G,n=B[e.l].x,r=B[e.l].y;if(.01<=L&&F(xa,ya,n,r)<=Math.max(K.width,K.height)/L+e.rb)for(var i=0;i<e.ab.length;i++){var l=e.ab[i],o=C(n,r,B[e.l].m,.001,l.$,t+l.offset);y.fillStyle=l.color,y.beginPath(),y.arc(o.x,o.y,l.size,0,2*Math.PI),y.fill()}}for(ta(0,0,125),a=1;a<B.length;a++)if(1==(e=B[a]).Ma?(y.fillStyle=e.hb,y.beginPath(),y.arc(e.x,e.y,e.a,0,2*Math.PI),y.fill(),jc(e.x,e.y,e.a,e.da,e.Ka)):(y.fillStyle=e.kb,kc(e,e.pb)),null!=e.j&&0<e.j.length)for(t=0;t<e.j.length;t++){r=(n=e.j[t]).x*e.a*.98+e.x,i=n.y*e.a*.98+e.y,l=-n.y,o=n.x;var h=3*n.size;0==n.g?(hc++,y.fillStyle="rgb("+n.tone+", "+n.tone+", "+n.tone+")",y.strokeStyle="rgb(200, 200, 200)",y.beginPath(),y.moveTo(r-l*n.size,i-o*n.size),y.lineTo(r+l*n.size,i+o*n.size),y.lineTo(r+l*n.size+n.x*h,i+o*n.size+n.y*h),y.lineTo(r-l*n.size+n.x*h,i-o*n.size+n.y*h),y.lineTo(r-l*n.size,i-o*n.size),y.fill()):(gc++,y.fillStyle="rgb("+n.tone+", "+.5*n.tone+", "+.5*n.tone+")",y.strokeStyle="rgb(200, 128, 128)",y.beginPath(),y.moveTo(r-l*n.size*.5,i-o*n.size*.5),y.lineTo(r+l*n.size*.5,i+o*n.size*.5),y.lineTo(r+l*n.size*.5+n.x*h,i+o*n.size*.5+n.y*h),y.lineTo(r-l*n.size*.5+n.x*h,i-o*n.size*.5+n.y*h),y.fill(),y.beginPath(),y.arc(r,i,1*n.size,0,2*Math.PI)),y.stroke()}for(a=0;a<H.length;a++)lc(e=H[a]),mc(e),va();for(a=1;a<B.length;a++)(e=B[a]).Ma||(y.fillStyle=e.jb,kc(e,e.eb),y.fillStyle=e.ib,y.beginPath(),y.arc(e.x,e.y,e.a,0,2*Math.PI),y.fill()),0<=e.da&&jc(e.x,e.y,e.a,e.da,e.Ka);for(a=1;a<B.length;a++){o=(e=B[a]).x*e.x+e.y*e.y,n=(t=Math.PI/2-Math.atan2(-e.y,-e.x))-(r=Math.acos(e.a/Math.sqrt(o+e.a*e.a))),i=t+r,l=1*e.a,0!=e.da&&(l=e.da),t=e.x+Math.sin(n)*l,n=e.y+Math.cos(n)*l,r=e.x+Math.sin(i)*l,i=e.y+Math.cos(i)*l,l=32*e.a,h=Math.sqrt(t*t+n*n);var b=Math.sqrt(r*r+i*i),s=Math.sqrt(o);o=t/h,h=n/h;var f=r/b;b=i/b,s=y.createLinearGradient(e.x,e.y,e.x+e.x/s*l,e.y+e.y/s*l),e=.005+Math.max((e.da-e.a)/32e3,0),s.addColorStop(0,"rgba(0, 0, 0, 0)"),s.addColorStop(e,"rgba(0, 0, 0, 0.8)"),s.addColorStop(1,"rgba(0, 0, 0, 0)"),y.fillStyle=s,y.beginPath(),y.moveTo(t,n),y.lineTo(t+o*l,n+h*l),y.lineTo(r+f*l,i+b*l),y.lineTo(r,i),y.closePath(),y.fill()}for(a=0;a<H.length;a++){for(lc(e=H[a]),t=0;t<e.ba.length;t++)y.fillStyle="rgb(255, 255, 255)",y.strokeStyle="rgb(180, 180, 255)",y.lineWidth=2,r=nc(n=e.ba[t]),y.beginPath(),y.lineTo(n.x+r.Ya,n.y+r.Za),y.lineTo(n.x+r.nb*(r.c+2)*r.Pa,n.y+r.Pa*(r.c+2)*r.ob),y.lineTo(n.x+r.Wa,n.y+r.Xa),y.fill(),y.stroke();va()}for(a=0;a<Ha.length;a++)(e=Ha[a]).time<=.1*e.speed&&1==e.fb&&ta(e.x,e.y,e.size/256),0!=e.bb&&(y.fillStyle="rgba(255, 255, 255, "+(1-Math.pow(e.time,1/3.5))+")",y.beginPath(),y.arc(e.x,e.y,Math.pow(4*e.time,.4)*e.size*e.bb,0,2*Math.PI),y.fill());for(a=0;a<Qa.length;a++)e=Qa[a],y.strokeStyle="rgb(255, 200, 200)",y.strokeStyle=e.color,y.lineWidth=e.size/(1.5*L),y.beginPath(),y.moveTo(e.x,e.y),t=D(e.la-H[0].speed.x,e.ma-H[0].speed.y),y.lineTo(e.x-t.x*e.size*5,e.y-t.y*e.size*5),y.stroke();for(a=0;a<Ra.length;a++){for(e=Ra[a],y.beginPath(),t=Math.pow(e.time,2),n=[255,220,200],r=[0,0,0],i=0;3>i;i++)r[i]=70*t+n[i]*(1-e.time);y.fillStyle="rgba("+r[0]+", "+r[1]+", "+r[2]+", "+(1-Math.sqrt(e.time))+")",y.arc(e.x,e.y,Math.sqrt(e.time)*e.size,0,2*Math.PI),y.fill()}if(0<Wa){for(y.globalAlpha=Wa,a=1;a<B.length;a++)e=B[a],t=B[e.l],y.strokeStyle=e.Oa,y.fillStyle=e.Oa,y.lineWidth=1/L,y.beginPath(),y.arc(t.x,t.y,e.$,0,2*Math.PI),y.stroke(),y.beginPath(),y.arc(e.x,e.y,e.a,0,2*Math.PI),y.fill(),t=2/L,0!=e.l&&(t=.02>=L?0:1.3/L),0<t&&v(e.name,e.x-4*e.name.length*t/2,e.y+Math.max(e.da,1.1*e.a),t,e.Oa);for(a=0;a<H.length;a++)e=H[a],y.fillStyle=0==e.g?"rgb(128, 255, 128)":1==e.g?"rgb(255, 128, 128)":"rgb(255, 255, 255)",y.beginPath(),y.arc(e.x,e.y,Math.min(5/L,100),0,2*Math.PI),y.fill();y.globalAlpha=1}if(a=H[0],y.strokeStyle="rgb(204,168,255)",y.lineWidth=Math.max(1/L,1),1.5>=L&&1<=L&&(y.globalAlpha=1-2*(L-1)),1.5>=L&&!a.ea&&null!=a.s){for(y.beginPath(),e=B[a.frame],t=0;t<a.s.length;t++)r=A(a.frame,a.s[t].time),n=a.s[t].x-r.x+e.x,r=a.s[t].y-r.y+e.y,0==t?y.moveTo(n,r):y.lineTo(n,r);y.stroke()}y.globalAlpha=1,e=Math.max(42/L,42),y.strokeStyle="rgb(128, 128, 128)",y.lineWidth=Math.max(2/L,2),y.beginPath(),y.arc(a.x,a.y,e,0,2*Math.PI),y.stroke(),n=-(t=oc(a)).x,r=-t.y,i=-t.y,l=t.x,o=t.y,h=-t.x,f=D(a.ya.x,a.ya.y),y.strokeStyle="rgb(255,214,117)",y.beginPath(),y.moveTo(a.x+t.x*e,a.y+t.y*e),y.lineTo(a.x+t.x*e*1.5,a.y+t.y*e*1.5),y.stroke(),y.beginPath(),y.moveTo(a.x+n*e*1.25,a.y+r*e*1.25),y.lineTo(a.x+n*e*1.5,a.y+r*e*1.5),y.stroke(),y.strokeStyle="rgb(87,188,255)",y.beginPath(),y.moveTo(a.x+i*e,a.y+l*e),y.lineTo(a.x+i*e*1.5,a.y+l*e*1.5),y.stroke(),y.beginPath(),y.moveTo(a.x+o*e*1.25,a.y+h*e*1.25),y.lineTo(a.x+o*e*1.5,a.y+h*e*1.5),y.stroke(),y.fillStyle="rgb(187,128,255)",y.beginPath(),y.arc(a.x+f.x*e,a.y+f.y*e,e/15,0,2*Math.PI),y.fill(),y.strokeStyle="white",t=Math.cos(a.b+Math.PI/2),n=Math.sin(a.b+Math.PI/2),y.beginPath(),y.moveTo(a.x+t*e,a.y+n*e),y.lineTo(a.x+t*e*1.25,a.y+n*e*1.25),y.stroke(),0<Gb&&Hb&&pc(),y.setTransform(1,0,0,1,0,0),0<=S&&(y.globalAlpha=S,a=ia(T),v(T,K.width/2-a/2,20,2,"white"),y.globalAlpha=1),0==P&&(a=ia("Paused"),v("Paused",K.width/2-a/2,50,2,"white")),qc(),window.requestAnimationFrame(ic)}window.requestAnimationFrame(function(a){Ma=a,ic(a)});var Wb=0;function rc(a){var e="mousedown"==a.type;1==a.which?H[0].Ea=e:2==a.which?(Db=e,a.preventDefault()):3==a.which&&(Cb=e)}K.addEventListener("wheel",function(a){Wb-=Math.sign(a.deltaY)}),K.addEventListener("mousemove",function(a){var e=K.getBoundingClientRect(),t=a.clientX-e.left;a=a.clientY-e.top,Ua=t,Va=a},!1),K.addEventListener("mousedown",rc,!1),K.addEventListener("mouseup",rc,!1),document.onkeydown=document.onkeyup=function(a){var e="keyup"==a.type;a=a.code;var t=H[0].c,n=1;e&&(n=0),"KeyT"==a&&(Hb=!e),"KeyW"==a?t.o=n:"KeyS"==a?t.o=-n:"KeyA"==a?t.b=-n:"KeyD"==a?t.b=n:"KeyQ"==a?t.g=-n:"KeyE"==a&&(t.g=n),2<P&&(t.o=0,t.b=0,t.g=0),e||("KeyL"==a&&(T=(wa=!wa)?"Camera locked":"Camera free",S=2),"Period"==a&&(++R>Xa.length-1?R=Xa.length-1:(P=Xa[R],T=P.toString()+"x Timewarp",S=2)),"Comma"==a&&(0>--R?R=0:(P=Xa[R],T=P.toString()+"x Timewarp",S=2))),H[0].ea&&sc(a,e)};var tc="rgba(0, 0, 0, 0.8)";function pc(){function a(){i=0,l+=16/L}var e=B[Gb],t=O.x,n=O.y;y.globalAlpha=4*Fb,wa&&(y.translate(t,n),y.rotate(H[0].b+Math.PI),y.translate(-t,-n)),y.fillStyle=tc,y.strokeStyle="rgb(255, 255, 255)",y.beginPath(),y.rect(t,n,320/L,350/L),y.fill(),y.stroke();var r=8/L,i=0,l=0;i+=v("Name: ",t+r,n+r,2/L,"rgb(255, 220, 200)"),i+=v(e.name,t+r+i,n+r,2/L,"rgb(255, 255, 255)"),a();var o=0,h=0;if(null!=e.j)for(var b=0;b<e.j.length;b++)0==e.j[b].g?o++:h++;0==o&&0==h?(i+=v("Planet is uninhabited",t+r,n+r+l,2/L,"rgb(255, 220, 200)"),a(),i+=v("Ore: ",t+r,n+r+l,2/L,"rgb(255, 220, 200)"),i+=v(e.oa.toString(),t+r+i,n+r+l,2/L,"rgb(255, 255, 255)")):(b=function(a){for(var e=0;e<a.length;e++){var o=.15/L;y.translate(t+i,n+l),y.scale(o,o),mc(a[e]),y.scale(1/o,1/o),y.translate(-t-i,-n-l),(i+=128*o)>=320/L-r&&(i=2*r,l+=350*o)}},i+=v("Cities: ",t+r,n+r+l,2/L,"rgb(255, 220, 200)"),i+=v(o.toString(),t+r+i,n+r+l,2/L,"rgb(0, 255, 0)"),i+=v(" / ",t+r+i,n+r+l,2/L,"rgb(255, 255, 255)"),i+=v(h.toString(),t+r+i,n+r+l,2/L,"rgb(255, 0, 0)"),a(),i+=v("Human Ships: ",t+r,n+r+l,2/L,"rgb(255, 220, 200)"),i+=v(e.Ba.length.toString(),t+r+i,n+r+l,2/L,"rgb(255, 255, 255)"),i+=v(" / ",t+r+i,n+r+l,2/L,"rgb(255, 255, 255)"),i+=v(e.Na.La.toString(),t+r+i,n+r+l,2/L,"rgb(255, 255, 255)"),i+=v("  Resources: ",t+r+i,n+r+l,2/L,"rgb(255, 220, 200)"),i+=v(Math.floor(100*e.sa).toString()+"%",t+r+i,n+r+l,2/L,"rgb(255, 255, 255)"),i=2*r,l+=32/L,b(e.Ba),i=0,i+=v("AI Ships: ",t+r,n+r+(l+=64/L),2/L,"rgb(255, 220, 200)"),i+=v(e.qa.length.toString(),t+r+i,n+r+l,2/L,"rgb(255, 255, 255)"),i+=v(" / ",t+r+i,n+r+l,2/L,"rgb(255, 255, 255)"),i+=v(e.Na.h.toString(),t+r+i,n+r+l,2/L,"rgb(255, 255, 255)"),i=2*r,l+=32/L,b(e.qa)),va(),y.globalAlpha=1}function qc(){function a(){e=0,t+=16}y.strokeStyle="rgba(166,255,128, 1.0)",y.lineWidth=1;var e=0,t=0;if(H[0].ea){var n=K.width-180,r=K.height/2-178;y.beginPath(),y.rect(n,r,1e3,256),y.stroke();var i=B[H[0].aa.f],l=["M","Mine",NaN];null!=i.j&&0!=i.j.length&&(l=["R","Repair",uc(),"U","Upgrade",vc(),"S","Sell Ore",8*U,"1","Fighter",0,"2","Freighter",4e3*!Ya,"3","Destroyer",14e3*!Za]);var o=0,h=0;if(null!=i.j&&0!=i.j.length)for(var b=0;b<i.j.length;b++)0==i.j[b].g?h++:o++;if(b="AI World",h>o?b="Human World":0==h&&0==o&&(b="Free World"),e+=v(b,n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),a(),a(),0<i.fa)v("Planet is at war",n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),a(),v(Math.floor(i.fa)+" until peace",n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)");else for(b=0;b<l.length/3;b++)v(l[3*b],n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e=20,v(l[3*b+1],n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e=120,v(Ba(l[3*b+2]),n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),a()}n=K.width-180,r=K.height-64,y.beginPath(),y.rect(n,r,1e3,1e3),y.stroke(),t=e=0,i=80,e+=v("Hull ",n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e=i,0>H[0].i?e+=v("Destroyed",n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"):(e+=v(Math.floor(H[0].i)+"/",n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e+=v(Math.floor(H[0].ca.za).toString(),n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)")),a(),e+=v("Cargo ",n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e=i,e+=v(U.toString()+"/",n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e+=v(Math.floor(H[0].ca.Sa).toString(),n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),a(),e+=v("Money ",n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e=i,e+=v(V.toString(),n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),a(),e+=v("Level ",n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e=i,e+=v(H[0].level.toString(),n+4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),y.beginPath(),y.rect(-5,r,185,1e3),y.stroke(),t=e=0,i=80,e+=v("Frame ",4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e=i,e+=v(B[H[0].frame].name,4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),a(),e+=v("Speed ",4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e=i,e+=v(Math.floor(Qb(H[0])).toString(),4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),a(),e+=v("Altitude ",4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e=i,e+=v(Math.floor(Rb(H[0])).toString(),4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),a(),e+=v("Total AI ",4+e,r+4+t,2,"rgba(166,255,128, 1.0)"),e=i,e+=v(gc.toString(),4+e,r+4+t,2,"rgba(166,255,128, 1.0)")}function wc(a,e,t,r){if(0==a){a=n(250,850)*e;var i=xc(n(25,60),n(140,150),a,0,I(0,1),I(0,.5),I(0,1),"0, 0, 0"),y=Ia;850<=n(0,1e3)?yb(i,.01*n(-70,50),z()):(i.oa=n(55,a*a*.0114),i.Fa=n(50,100))}else if(1==a)a=n(300,600)*e,i=xc(n(25,30),n(90,160),a,a+n(120,170),I(1,1),I(1,.5),I(1,1),"120, 120, 255"),y=Ja,yb(i,.01*n(-70,100),z());else if(2==a)a=n(350,900)*e,i=xc(n(15,25),n(80,120),a,a+n(120,170),I(2,1),I(2,.5),I(2,1),"255, 120, 120"),y=La,200<=n(0,1e3)?yb(i,.01*n(-80,40),z()):(i.oa=n(50,a*a*.004),i.Fa=n(200,500));else if(3==a){a=n(700,1800)*e,i=I(3,1),y=a,a+=n(50,300),e=i.splice(0,4,""),i={x:0,y:0,a:y,da:a,Ka:e=e.splice(i.length-5,2,""),hb:i,yb:I(3,1),Ma:!0},y=Ka,i.oa=0,i.Fa=n(1e3,2e3)}else 4==a&&(a=n(20,150)*e,i=xc(n(25,60),n(140,150),a,0,I(0,1),I(0,.5),I(0,1),"0, 0, 0"),y=Ia,i.oa=n(35,a*a*.14));return i.m=4*Math.PI*i.a*i.a,i.Oa=I(-1,2),y=y[t%y.length],-1!=r&&(y=B[r].name+" "+t),i.name=y,i}function wb(){Sa={x:0,y:0,a:5e3,m:375e6,Db:!0},B.push(Sa);for(var a=0;a<Pa;a++){var e=n(0,4),t=n(9e3,8e4);1==e&&(4e4>=t||8e4<=t)&&(e=2);var r=wc(e,1,a,-1);r.$=t,r.ja=n(-5e4,5e4),r.l=0,r.type=e,r.ia=B.length,B.push(r)}for(a=1;a<Pa+1;a++){var i=n(0,B[a].a/300);for(t=0;t<i;t++){3==(e=n(0,4))&&(e=0),(r=wc(e,.01*n(25,60),t+1,a)).a>=.6*B[a].a&&(r.a*=.5,r.da*=.5);var y=B[a].a+5*r.a;r.$=n(y,y+B[a].$/16e3*B[a].a),r.ja=n(0,5e5),r.l=a,r.type=e,r.ia=B.length,B.push(r)}if(900<=n(0,1e3)&&150<=B[a].a){r=(e=n(1.5*B[a].a,8*B[a].a))+.01*n(50,300)*B[a].a,i=3e-7*n(80,400),t=a,y=[],100<=(i*=Math.PI*r*r-Math.PI*e*e)&&(i=100);for(var l=0;l<i;l++){var o=n(e,r),h=n(-1e4,1e4),b=n(5,50),s=I(2,.6);y.push({$:o,offset:h,size:b,color:s})}Ta.push({l:t,Bb:e,rb:r,ab:y})}}for(Kb(),i=r=e=!1,a=1;a<B.length;a++)if(1==B[a].type&&(e=!0),2==B[a].type&&(r=!0),a<Pa)for(t=1;t<Pa;t++)t!=a&&9e3>=F(B[a].x,B[a].y,B[t].x,B[t].y)&&(i=!0);(0==e||0==r||1>=Ta.length||i)&&(B=[],aa+=n(1,5e3),wb())}function xc(a,e,t,r,i,y,l,o){var h=n(0,1e4),b=Array(64),s=Array(64);for(noise.Ia(h),h=0;64>h;h++){var f=noise.v(h/64*a*4,8)*e*.25;b[h]=1.5*Math.max(noise.v(h/64*a,0)*e+noise.v(h/64*a*2,5)*e*.5,0),s[h]=.2*(noise.v(h/64*a,40)*e+f)}return{x:0,y:0,a:t,da:r,jb:i,kb:y,ib:l,Ka:o,pb:b,eb:s,Ma:!1,j:[],oa:0,Fa:0}}function Vb(a){for(var e=0,t=0,n=0;n<a.j.length;n++)0==a.j[n].g?e+=a.j[n].size/20:t+=a.j[n].size/20;return{La:e=Math.min(Math.floor(e),26),h:t=Math.min(Math.floor(t),26)}}function yb(a,e,t){noise.Ia(t),t=1/(a.a/34);for(var r=0;r<2*Math.PI;r+=t){var i=1.2*noise.v(r,0);if(.2<=Math.abs(i)){nside=Math.max(Math.min(i+e,1),-1),i=1;var y=Math.min(Math.max(.07*Math.abs(i)*a.a,16),40);0<=nside&&(i=0),a.j.push({x:Math.cos(r),y:Math.sin(r),size:y,g:i,tone:n(80,200),i:y,Ab:y})}}for(e=Vb(a),a.Ba=[],a.qa=[],t=0;t<e.La/2+e.h;t++)t<e.La/2?a.Ba.push(oa(0)):a.qa.push(oa(1));a.Na=e,a.Ca=[],a.fa=0,a.xb=0,a.zb=0,a.sa=.01*n(5,35)}var Lb=!1;function Mb(a,e){if(null!=a.fa)if(a.fa-=e,0>=a.fa){for(var t=0;t<a.Ca.length;t++)Ea(a.Ca[t],a.ia);a.Ca=[]}else if(t=function(e,t){for(var r=0;r<t&&!(0>=e.length);r++){var i=n(0,e.length-1),y=e[i];e.splice(i,1),(i=D(n(0,1e3)-500,n(0,1e3)-500)).x=1.02*i.x*a.a,i.y=1.02*i.y*a.a,y.x=a.x+i.x,y.y=a.y+i.y,y.b=Math.atan2(i.y,i.x)-Math.PI/2,y.speed=qa(a),y.frame=a.ia,Fa(y,a.ia,n(60,a.a)),H.push(y),a.Ca.push(y)}},Lb=!0,a.Ta||0>=a.Eb){var r=n(1,a.qa.length/2),i=r*a.sa;t(a.qa,r),t(a.Ba,i),a.Ta=!1}}function jc(a,e,t,n,r){(t=y.createRadialGradient(a,e,t,a,e,n)).addColorStop(0,"rgba("+r+",0.5)"),t.addColorStop(1,"rgba("+r+", 0)"),y.fillStyle=t,y.beginPath(),y.arc(a,e,n,0,2*Math.PI),y.fill()}function kc(a,e){y.beginPath();for(var t=e.length,n=0;n<t;n++){var r=n/t*2*Math.PI,i=Math.cos(r);r=Math.sin(r);var l=e[n]+15;i=i*a.a+i*l+a.x,r=r*a.a+r*l+a.y,0==n?y.moveTo(i,r):y.lineTo(i,r)}y.fill()}function pa(a,e,t,r){function i(a,e){o.push({x:a,y:e})}function y(a,e,t,n){b.push({x:a,y:e,size:t,t:0,dir:n})}var l=[2,12,50,100,50,1,9,100,200,150,.8,9,400,250,80];aa=e,e={};var o=[],h=[],b=[];if(0==a){var s=.5*n(50,100),f=s*n(100,140)*.01,g=f/(2*s);i(-s/2,0),i(s/2,0),i(0,f),i(.5*f*g,.5*f),i(.8*s,.5*f),i(.8*-s,.5*f),i(0,2*f),i(.8*s,.5*f),i(.5*f*g,.5*f),i(0,f);var c=s*n(30,70)*.005;y(-c,0,6,0),y(c,0,6,0),y(0,2*f,6,Math.PI),y(0,2*f,6,Math.PI/2),y(0,2*f,6,-Math.PI/2),y(c,0,6,Math.PI/2),y(-c,0,6,-Math.PI/2),g=(c=n(60,90)*f*.01)*g*.5,h.push({x:g,y:c,dir:0,size:6,angle:Math.PI/2.5,speed:8,w:.07,u:0}),h.push({x:-g,y:c,dir:0,size:6,angle:Math.PI/2.5,speed:8,w:.07,u:0})}else 1==a?(g=(c=(f=(s=.5*n(100,160))*n(140,180)*.01)*n(130,170)*.01)-f,i(-s/2,0),i(s/2,0),i(s/2,f),i(-s/2,f),i(s/8,f),i(s/8,c),i(-s/8,c),i(-s/8,f),i(-s/2,f),c=s*n(30,70)*.05,y(-(c=s*n(30,70)*.005),0,12,0),y(c,0,12,0),y(0,.8*g+f,7,Math.PI),y(0,.8*g+f,7,Math.PI/2),y(0,.8*g+f,7,-Math.PI/2),y(c,0,7,Math.PI/2),y(-c,0,7,-Math.PI/2),c=n(70,100)*f*.01,g=n(50,80)*s*.005,h.push({x:g,y:c,dir:0,size:12,angle:Math.PI/2,speed:4,w:.3,u:0}),h.push({x:-g,y:c,dir:0,size:12,angle:Math.PI/2,speed:4,w:.3,u:0}),c=n(30,60)*f*.01,g=n(50,80)*s*.005,h.push({x:g,y:c,dir:-Math.PI/2,size:16,angle:Math.PI/2,speed:2,w:.5,u:0}),h.push({x:-g,y:c,dir:Math.PI/2,size:16,angle:Math.PI/2,speed:2,w:.5,u:0})):2==a&&(f=(s=.5*n(180,260))*n(200,320)*.01,g=s*n(40,70)*.01,c=n(30,60)*f*.01,i(s/2,0),i(g/2,c),i(s/2,f),i(0,1.1*f),i(-s/2,f),i(-g/2,c),i(-s/2,0),y(s/2.2,0,14,0),y(-s/2.2,0,14,0),y(.5*-g,c,12,1.15*Math.PI),y(.4*g,.74*f,12,Math.PI/2),y(.4*-g,.74*f,12,-Math.PI/2),y(.5*g,.5*c,12,Math.PI/2),y(.5*-g,.5*c,12,-Math.PI/2),y(.5*g,c,12,1.15*-Math.PI),h.push({x:0,y:c,dir:0,size:32,angle:Math.PI,speed:2,w:1,u:0}),h.push({x:g/2.2,y:1.8*c,dir:-Math.PI/2.5,size:20,angle:Math.PI/2,speed:2,w:.4,u:0}),h.push({x:-g/2.2,y:1.8*c,dir:Math.PI/2.5,size:20,angle:Math.PI/2,speed:2,w:.4,u:0}),h.push({x:g/1.8,y:.95*f,dir:0,size:12,angle:Math.PI/2.5,speed:4,w:.1,u:0}),h.push({x:-g/1.8,y:.95*f,dir:0,size:12,angle:Math.PI/2.5,speed:4,w:.1,u:0}));for(g=1+.11*r,e.qb=l[5*a]*g,e.speed=l[5*a+1]*g,e.za=l[5*a+2]*g,e.Fa=l[5*a+3]*g,e.Sa=l[5*a+4]*g,l=e.za,c=0;c<h.length;c++)h[c].size*=g,h[c].w/=g/2;return g=.01*n(14,25),c=ra(t),{level:r,i:l,Da:!1,type:a,ca:e,na:o,ga:h,ba:b,width:s,length:f,x:0,y:0,b:Math.PI,ha:0,speed:{x:0,y:0},c:{o:0,g:0,b:0},ya:{x:0,y:0},ea:!1,scale:g,Ea:!1,g:t,color:c,h:{ya:n(5,22),xa:null,Cb:null,Aa:null,level:r,target:-1,wa:0}}}function mc(a){y.fillStyle=a.color,y.strokeStyle="white",y.lineWidth=2,y.beginPath(),y.moveTo(a.na[0].x,a.na[0].y);for(var e=1;e<a.na.length;e++)y.lineTo(a.na[e].x,a.na[e].y);for(y.lineTo(a.na[0].x,a.na[0].y),y.fill(),y.stroke(),e=0;e<a.ba.length;e++){y.fillStyle="rgb(60, 60, 60)",y.strokeStyle="white",y.lineWidth=2;var t=a.ba[e],n=nc(t);y.beginPath(),y.moveTo(t.x,t.y),y.lineTo(t.x+n.Ya,t.y+n.Za),y.lineTo(t.x+n.Wa,t.y+n.Xa),y.lineTo(t.x,t.y),y.fill(),y.stroke(),y.beginPath(),y.arc(t.x,t.y,n.Pa,0,2*Math.PI),y.fill(),y.stroke()}for(e=0;e<a.ga.length;e++)y.lineWidth=2,n=(t=a.ga[e]).size,y.beginPath(),y.rect(t.x-n/2,t.y-n/2,n,n),y.fill(),y.stroke(),y.beginPath(),y.lineWidth=4,y.moveTo(t.x,t.y),n*=1.5,y.lineTo(t.x+n*Math.cos(t.ta+Math.PI/2-a.b),t.y+n*Math.sin(t.ta+Math.PI/2-a.b)),y.stroke()}function lc(a){y.translate(a.x,a.y),y.scale(a.scale,a.scale),y.rotate(a.b),y.translate(0,-a.length/2)}function nc(a){var e=a.size,t=Math.cos(a.dir-Math.PI/2),n=Math.sin(a.dir-Math.PI/2),r=Math.cos(a.dir),i=Math.sin(a.dir);return{Ya:t*e*2+r*e*.7,Za:n*e*2+i*e*.7,Wa:t*e*2-r*e*.7,Xa:n*e*2-i*e*.7,c:8*(a.t+0),Pa:e,nb:t,ob:n}}function yc(a){var e=0,t=0;return 0<=a?e=a:t=-a,{pa:e,ra:t}}function Ob(a,e){for(var t=e.x-a.x,n=e.y-a.y,r=0;r<a.ga.length;r++){var i=a.ga[r],y=a.b;i.dir=za(i.dir);var l=y+i.dir+Math.PI/2;l=za(l);var o=Math.cos(l);l=Math.sin(l),y=i.dir+y;var h=Math.atan2(n-l,t-o);(o=Math.atan2(n,t)-Math.atan2(l,o))>Math.PI?o-=2*Math.PI:o<=-Math.PI&&(o+=2*Math.PI),Math.abs(o)<=i.angle?(i.cb=h-.5*Math.PI,i.Ra=!0):(i.cb=y,i.Ra=!1),null==i.ta&&(i.ta=y),i.ta=i.cb,o=Ca(0,-a.length/2,a.b),l=1.5*i.size,y=Math.cos(i.ta+Math.PI/2),h=Math.sin(i.ta+Math.PI/2);var b=Ca(i.x*a.scale,i.y*a.scale,a.b);b.x+=l*y*a.scale,b.y+=l*h*a.scale,i.sb={x:a.x+b.x+a.scale*o.x,y:a.y+b.y+a.scale*o.y,lb:y,mb:h}}}function Tb(a){a.s=[],a.gb=-1,a.s.push({x:a.x,y:a.y,ua:a.speed.x,va:a.speed.y,time:G});var e=.5,t=500;0==a.frame?(e=5,t=15e3,minDist=1500):0!=B[a.frame].l&&(e=.25);for(var n=0;n<t/e;n++){var r={x:a.s[n].x,y:a.s[n].y},i=a.s[n].ua,y=a.s[n].va,l=a.s[n].time;l+=e,r.x+=i*e,r.y+=y*e;var o=ka(r,l);if(i+=o.x*e,y+=o.y*e,null!=(o=ma(r,l))){e=A(o.f,l),a.s.push({x:o.ua+e.x,y:o.va+e.y,ua:0,va:0,time:l}),a.gb=o.f;break}a.s.push({x:r.x,y:r.y,ua:i,va:y,time:l})}}function zc(a){var e=qa(B[a.frame]);return{x:a.speed.x-e.x,y:a.speed.y-e.y}}function oc(a){return D((a=zc(a)).x,a.y)}function Sb(a){var e=B[a.frame];return F(0,0,a.x-e.x,a.y-e.y)}function Rb(a){return Sb(a)-B[a.frame].a}function Pb(a){return a=oc(a),Math.atan2(a.y,a.x)-Math.PI/2}function Qb(a){return F(0,0,(a=zc(a)).x,a.y)}function Ub(a,e){if(n(0,1e3)>=a.i/a.ca.za*2e3){var t=a.x+n(-10,10),r=a.y+n(-10,10),i=a.speed.x+n(-10,10),y=a.speed.y+n(-10,10),l=n(4,15),o=.005*n(100,200);Ra.push({x:t,y:r,la:i,ma:y,time:0,size:l,speed:o})}if(a.Da){if(a.c.o=0,a.c.g=0,a.c.b=0,a.Ea=!1,a.i-=e,-50>=a.i&&2!=a.g)return M(a.x,a.y,a.speed.x,a.speed.y,n(50,200),1,1,!1),!0}else 0>=a.i&&(M(a.x,a.y,a.speed.x,a.speed.y,n(100,400),.7,2,!1,1),a.Da=!0,a.ha=.01*n(-400,400));if(t=yc(a.c.b),r=yc(a.c.g),i=yc(a.c.o),a.ba[0].t=i.pa,a.ba[1].t=i.pa,a.ba[2].t=i.ra,2==a.type&&(a.ba[7].t=i.ra),a.ba[3].t=Math.max(r.pa,t.pa),a.ba[4].t=Math.max(r.ra,t.ra),a.ba[5].t=Math.max(r.pa,t.ra),a.ba[6].t=Math.max(r.ra,t.pa),1==a.ea){if(i=A(a.aa.f,G),3==(r=B[a.aa.f]).type)return!0;if(t=E(r.l,r.m,r.$,G,r.ja),a.x=i.x+a.aa.ua,a.y=i.y+a.aa.va,a.speed.x=t.x,a.speed.y=t.y,a.ha=0,0<(i=a.c.o)&&(a.ea=!1,a.speed.x=15*a.aa.tb+t.x,a.speed.y=15*a.aa.ub+t.y,a.x+=a.speed.x*e,a.y+=a.speed.y*e),null!=r.fa&&0>r.fa){if(0==a.g)return r.Ba.push(a),!0;if(1==a.g)return r.qa.push(a),!0}}else null!=(i=ma(r={x:a.x,y:a.y},G))&&(t=E((t=B[i.f]).l,t.m,t.$,G,t.ja),100<=(t=F(0,0,a.speed.x-t.x,a.speed.y-t.y))&&(a.i-=.8*(t-100),M(a.x,a.y,a.speed.x,a.speed.y,.4*(t-100),.8,2,!1)),a.ea=!0,a.aa=i),i=a.c.o,t=a.c.g,y=Math.sin(a.b+Math.PI/2),l=Math.cos(a.b),o=Math.sin(a.b),a.speed.x+=Math.cos(a.b+Math.PI/2)*i*a.ca.speed*e*5,a.speed.y+=y*i*a.ca.speed*e*5,a.speed.x+=l*-t*a.ca.speed*e*5,a.speed.y+=o*-t*a.ca.speed*e*5,a.ha+=a.ca.qb*e*a.c.b,a.x+=a.speed.x*e,a.y+=a.speed.y*e,a.b+=a.ha*e,t=ka(r,-1),a.speed.x+=t.x*e,a.speed.y+=t.y*e,a.ya=t;for(r=0;r<a.ga.length;r++)a.Ea&&1==a.ga[r].Ra&&0>=a.ga[r].u&&(y=D((i=(o=a.ga[r]).sb).lb,i.mb),l=o.size/8,t=650-o.size/32*350,M(i.x,i.y,a.speed.x+15*y.x,a.speed.y+15*y.y,4*l,1,.5,!0,.8),o.u=o.w,o=a.g,Qa.push({x:i.x,y:i.y,la:y.x*t+a.speed.x,ma:y.y*t+a.speed.y,g:o,size:l,Qa:10,color:ra(o)})),a.ga[r].u-=e;return!1}function uc(){return Math.floor(500*(1-H[0].i/H[0].ca.za))}function vc(){return H[0].level*H[0].level*1e3}var Ac=!1;function sc(a,e){var t=B[H[0].aa.f];if(e&&"KeyU"==a&&(Ac=!1),!e)if(0==t.j.length)"KeyM"==a&&U<H[0].ca.Sa-1&&0>=Ib&&0<t.oa&&(U++,t.oa--,980<=n(0,1e3)?(T="Accident while mining",S=1,H[0].i-=n(1,5),zzfx(1,.1,50,.6,.5,.3,1,3.6,.03)):zzfx(1,.1,n(220,320),.01*n(8,17),.66,.3,0,3.6,.03),Ib=.01*n(15,60));else{var r=function(a){return(a=pa(a,bb,2,H[0].level)).s=[],a.frame=H[0].frame,a.ea=!0,a.aa=H[0].aa,a.b=H[0].b,a},i=-1;"KeyR"==a?V>=uc()&&(V-=uc(),H[0].i=H[0].ca.za,H[0].Da=!1):"KeyU"==a?Ac||(V>=vc()&&(V-=vc(),H[0].level++,(t=r(H[0].type)).i=H[0].i,H[0]=t,zzfx(.7,.1,15,.5,.13,0,0,30,.79)),Ac=!0):"KeyS"==a?(V+=8*U,0!=8*U&&zzfx(1,.1,836,.2,.01,0,.3,1.3,.78),t.sa+=2e-4*U,t.sa=Math.min(t.sa,1),U=0):"Digit1"==a?0!=H[0].type&&(i=0,zzfx(1,.1,2,.8,.42,0,0,67,.1)):"Digit2"==a?V>=4e3*!Ya&&1!=H[0].type&&(i=1,V-=4e3*!Ya,Ya=!0,zzfx(1,.1,5,.8,.42,-.012,0,43,400)):"Digit3"==a&&V>=14e3*!Za&&2!=H[0].type&&(i=2,V-=14e3*!Za,Za=!0,zzfx(1,.1,2,.8,.42,0,.6,33,.1)),-1!=i&&($a[H[0].type]=H[0].level,ab[H[0].type]=H[0].i,H[0]=r(i),0==ab[i]&&(ab[i]=H[0].i),H[0].i=ab[i],H[0].level=$a[i])}}var fc=[0,261.63,392,523.25,739.99,932.33,783.99,1046.5,622.25,415.3,293.66,130.81,185,174.61,349.23,369.99],$b=[1,4,5,1,0,2,0,0,0,3,0,2,0,4,0,0,0,5,0,1,0,4,0,0,0,3,0,2,0,2,0,2,1,6,7,1,0,2,0,0,0,3,0,2,0,6,0,0,0,7,0,1,0,6,0,0,0,3,0,2,0,2,0,2],ac=[1,3,0,1,0,8,5,0,0,6,0,0,0,3,0,0,10,8,0,1,1,6,0,0,0,3,4,0,0,9,0,0],bc=[0,11,0,11,0,11,0,0,0,0,0,7,0,0,0,0,0,0,0,11,0,11,0,0,0,12,0,7,0,13,0,0,0,11,1,11,0,11,15,0,0,0,14,7,0,0,1,0,0,0,0,11,0,11,0,0,0,12,1,7,0,13,15,0],cc=2,ec=.25,dc=0,Yb=.1,Zb=bc,Nb=0,Xb=!1;